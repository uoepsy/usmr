<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.38">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>USMR - 8A: Multiple Linear Regression</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script>
function toggle_visibility(id1, id2) {
var e = document.getElementById(id1);
var f = document.getElementById(id2);
e.style.display = ((e.style.display!='none') ? 'none' : 'block');
if(f.classList.contains('fa-hand-o-right')) {
    f.classList.add('fa-hand-o-down')
    f.classList.remove('fa-hand-o-right')
} else {
    f.classList.add('fa-hand-o-right')
    f.classList.remove('fa-hand-o-down')
}
}
</script>

<script src="https://kit.fontawesome.com/120b08a6f5.js" crossorigin="anonymous"></script>
<link href="site_libs/panelset-0.2.6/panelset.css" rel="stylesheet">
<script src="site_libs/panelset-0.2.6/panelset.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">USMR</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-week-1" role="button" data-bs-toggle="dropdown" aria-expanded="false">Week 1</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-week-1">    
        <li>
    <a class="dropdown-item" href="./01a_R.html">
 <span class="dropdown-text">1A: First look at R/RStudio</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./01b_data.html">
 <span class="dropdown-text">1B: More R: Basic Data Skills</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./01_ex.html">
 <span class="dropdown-text">Exercises: Intro R</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-week-2" role="button" data-bs-toggle="dropdown" aria-expanded="false">Week 2</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-week-2">    
        <li class="dropdown-header">2A: Measurements &amp; Distributions</li>
        <li class="dropdown-header">2B: Sampling &amp; Curves</li>
        <li class="dropdown-header">Exercises: More R; Estimates &amp; Intervals</li>
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-week-3" role="button" data-bs-toggle="dropdown" aria-expanded="false">Week 3</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-week-3">    
        <li class="dropdown-header">3A: Foundations of Inference</li>
        <li class="dropdown-header">3B: Practical Inference</li>
        <li class="dropdown-header">Exercises: T-tests</li>
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-week-4" role="button" data-bs-toggle="dropdown" aria-expanded="false">Week 4</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-week-4">    
        <li class="dropdown-header">4A: Chi-Square Tests</li>
        <li class="dropdown-header">4B: Revisiting NHST</li>
        <li class="dropdown-header">Exercises: Chi-Square Tests</li>
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-week-5" role="button" data-bs-toggle="dropdown" aria-expanded="false">Week 5</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-week-5">    
        <li class="dropdown-header">5A: Covariance &amp; Correlation</li>
        <li class="dropdown-header">Exercises: Cov, Cor, Models</li>
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-week-6" role="button" data-bs-toggle="dropdown" aria-expanded="false">Week 6</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-week-6">    
        <li class="dropdown-header">Walkthrough: Advanced Data Wrangling</li>
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-week-7" role="button" data-bs-toggle="dropdown" aria-expanded="false">Week 7</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-week-7">    
        <li class="dropdown-header">7A: Simple Linear Regression</li>
        <li class="dropdown-header">Exercises: Simple Linear Regression</li>
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-week-8" role="button" data-bs-toggle="dropdown" aria-expanded="false">Week 8</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-week-8">    
        <li class="dropdown-header">8A: Multiple Linear Regression</li>
        <li class="dropdown-header">Exercises: Multiple Linear Regression</li>
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-week-9" role="button" data-bs-toggle="dropdown" aria-expanded="false">Week 9</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-week-9">    
        <li class="dropdown-header">9A: Interactions</li>
        <li class="dropdown-header">9B: Categorical Predictors</li>
        <li class="dropdown-header">Exercises: Interactions</li>
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-week-10" role="button" data-bs-toggle="dropdown" aria-expanded="false">Week 10</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-week-10">    
        <li class="dropdown-header">10A: GLM!</li>
        <li class="dropdown-header">Exercises: Logistic Regression</li>
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-week-11" role="button" data-bs-toggle="dropdown" aria-expanded="false">Week 11</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-week-11">    
        <li class="dropdown-header">11A: Common Tests as Linear Models</li>
        <li class="dropdown-header">11B: Writing Up</li>
    </ul>
  </li>
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-multiple-regression-model" id="toc-the-multiple-regression-model" class="nav-link active" data-scroll-target="#the-multiple-regression-model">The Multiple Regression Model</a></li>
  <li><a href="#multiple-regression-coefficients" id="toc-multiple-regression-coefficients" class="nav-link" data-scroll-target="#multiple-regression-coefficients">Multiple Regression Coefficients</a></li>
  <li><a href="#fitting-multiple-regression-models" id="toc-fitting-multiple-regression-models" class="nav-link" data-scroll-target="#fitting-multiple-regression-models">fitting multiple regression models</a></li>
  <li><a href="#multiple-categories-multiple-regression" id="toc-multiple-categories-multiple-regression" class="nav-link" data-scroll-target="#multiple-categories-multiple-regression">multiple categories = multiple regression</a></li>
  <li><a href="#model-evaluation" id="toc-model-evaluation" class="nav-link" data-scroll-target="#model-evaluation">Model Evaluation</a>
  <ul class="collapse">
  <li><a href="#adjusted-r2" id="toc-adjusted-r2" class="nav-link" data-scroll-target="#adjusted-r2">Adjusted <span class="math inline">\(R^2\)</span></a></li>
  <li><a href="#joint-test" id="toc-joint-test" class="nav-link" data-scroll-target="#joint-test">Joint test</a></li>
  </ul></li>
  <li><a href="#model-comparisons" id="toc-model-comparisons" class="nav-link" data-scroll-target="#model-comparisons">Model Comparisons</a></li>
  <li><a href="#types-of-ss" id="toc-types-of-ss" class="nav-link" data-scroll-target="#types-of-ss">Types of SS</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">8A: Multiple Linear Regression</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p>The simple linear regression model with a single predictor - <code>lm(y ~ x1)</code> - is a useful introduction to the idea of model-based thinking, but it’s not clear how much benefit this gives us as it is actually equivalent to the basic statistical tests we have already seen.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">outcome (y)</th>
<th style="text-align: left;">predictor (x)</th>
<th style="text-align: left;">regression</th>
<th style="text-align: left;">equivalent to</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">continuous</td>
<td style="text-align: left;">continuous</td>
<td style="text-align: left;">lm(y ~ x)</td>
<td style="text-align: left;">cor.test(x,y)</td>
</tr>
<tr class="even">
<td style="text-align: left;">continuous</td>
<td style="text-align: left;">binary</td>
<td style="text-align: left;">lm(y ~ x)</td>
<td style="text-align: left;">t.test(y ~ x)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="optional-begin">
<span id="opt-start-1" class="fa fa-hand-o-right optional-icon clickable" onclick="toggle_visibility('opt-body-1', 'opt-start-1')"> <span class="olab">Optional: Equivalence of Correlation Coefficient and <strong>Standardised</strong> Regression Coefficient</span></span>
</div>
<div id="opt-body-1" class="optional-body" style="display: none;">
<p>The covariance is a measure of the shared variance in two variables (i.e., how one variable varies with the other). However, it is hard to interpret because it is dependent on the units of the variables. Correlation is a <em>standardised</em> way of expressing this.</p>
<p>One way to think about this is to remember that we can <strong>standardise</strong> our variables (subtract each value from the mean and divide by the standard deviation (See, e.g.&nbsp;<a href="02b_sampling.html#the-standard-normal-distribution" target="_blank">2B #the-standard-normal-distribution</a>)), which transforms our set of numbers so that they have a mean of zero and a standard deviation of one. If we standardise both variable <span class="math inline">\(x\)</span> and variable <span class="math inline">\(y\)</span>, the covariance of <span class="math inline">\(x_{standardised}\)</span> and <span class="math inline">\(y_{standardised}\)</span> is the same as the correlation between <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> (see <a href="05a_covcor.html#covariance-&amp;-correlation" target="_blank">5A #covariance-&amp;-correlation</a>).<br>
TODO CHECK LINK</p>
<p>If you’ve been reading these “optional dropdowns”, you may remember that the regression coefficient from <code>lm(y ~ x)</code> is <em>also</em> the covariance between <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>, simply rescaled to be the amount of change in <span class="math inline">\(y\)</span> when <span class="math inline">\(x\)</span> changes by 1 (see the optional dropdown in <a href="07a_slr.html#the-model" target="_blank">7A #the-model</a>).</p>
<p>So actually, all these metrics are pretty much the same thing, only scaled in different ways. And whether we perform a test of the relationship (e.g.&nbsp;test the correlation using <code>cor.test()</code>, or test of the regression slope from <code>lm(y~x)</code>), we’re actually testing the same thing:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(df<span class="sc">$</span>x_cont, df<span class="sc">$</span>y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  df$x_cont and df$y
t = 14.484, df = 98, p-value &lt; 2.2e-16
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.7509427 0.8794017
sample estimates:
      cor 
0.8255877 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x_cont, <span class="at">data =</span> df))<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Estimate Std. Error   t value     Pr(&gt;|t|)
(Intercept) -0.1139823 0.09369032 -1.216586 2.266838e-01
x_cont       1.3220364 0.09127610 14.483927 4.290037e-26</code></pre>
</div>
</div>
<p>TODO t value, p-value.</p>
</div>
<p class="optional-end">
</p>
<p>The real power of regression models comes into effect when we start to concern ourselves with more than just “one outcome explained by one predictor”.</p>
<section id="the-multiple-regression-model" class="level1">
<h1>The Multiple Regression Model</h1>
<p>Last week was all about “y predicted by x”.<br>
This week, enter… x2.</p>
<p>We’re initially looking at the case of “one outcome, two predictors”, but the beauty of this is that the logic scales up to however many predictor variables we want.</p>
<p>When we fitted the regression model <span class="math inline">\(y = b_0 + b_1(x) + \epsilon\)</span>, we were fitting a <em>line</em> to a scatterplot of points that we plotted in <em>2 dimensions</em> (an x-axis and a y-axis).</p>
<p>When we fit a regression model with two predictors, “y predicted by x1 and x2” (<span class="math inline">\(y = b_0 + b_1(x_1) + b_2(x_2) + \epsilon\)</span>), we are fitting a <em>plane</em> (or “surface”) to a 3-dimensional cloud of datapoints (<a href="#fig-regsurf">Figure&nbsp;1</a>).</p>
<p>The model is now determined by 3 numbers:</p>
<ul>
<li>the <strong>intercept</strong>, denoted <span class="math inline">\(b_0\)</span>.<br>
This is the point at which the line hits the y-axis (i.e.&nbsp;where <span class="math inline">\(x_1=0\)</span> <strong>and</strong> <span class="math inline">\(x_2=0\)</span>)</li>
<li>the <strong>slope of x1</strong>, in this case denoted <span class="math inline">\(b_1\)</span>.<br>
This is the angle of the regression plane with respect to the axis of <span class="math inline">\(x_1\)</span>. It is the amount which the plane increases for every 1 increase in <span class="math inline">\(x_1\)</span>.<br>
</li>
<li>the <strong>slope of x2</strong>, in this case denoted <span class="math inline">\(b_2\)</span>.<br>
This is the angle of the regression plane with respect to the axis of <span class="math inline">\(x_2\)</span>. It is the amount which the plane increases for every 1 increase in <span class="math inline">\(x_2\)</span>.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-regsurf" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="08a_mlr_files/figure-html/fig-regsurf-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Figure 1: Regression surface for y~x1+x2, from two different angles</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Don’t worry about trying to figure out how to visualise it if we had any more explanatory variables! We can only conceive of 3 spatial dimensions. One could imagine this surface changing over time, which would bring in a 4th dimension, but beyond that, it’s not worth trying! However, the logic stays the same when we increase this to having <span class="math inline">\(p\)</span> predictors, but we are talking about a <span class="math inline">\(p\)</span>-dimensional surface, and each coefficient is the angle of that surface with respect to each predictor.</p>
<p>So <strong>why</strong> is this a useful thing to do? How exactly are the coefficients from a multiple regression model different from those from a simple regression model?</p>
</section>
<section id="multiple-regression-coefficients" class="level1">
<h1>Multiple Regression Coefficients</h1>
<p>The benefit of multiple regression models is that it allows us to exercise <em>statistical control</em>.</p>
<p>if we have multiple predictor variables in our model, the coefficients we get out represent the association between the outcome and the bit of each variable that is unique from the other variables.</p>
<p>A common way to build this intuition is to consider a venn diagram with a circle showing the variance in each variable. The overlap between circles shows the covariance.</p>
<p>slr venn mlr venn cov x1 x2 = 0 mlr venn</p>
<div class="statbox">
<p><strong>Example: Caffeine Heart Rates</strong></p>
<p>We have a sample of 100 people, and we measure their resting heart rate and their caffeine consumption. We’re interested in estimating how caffeine consumption is associated with differences in resting heart rate.</p>
<p>However, we also know that heart rate increases with age <em>and</em> we think that older people tend to drink less caffeine. So we want to isolate the differences in heart rate due to caffeine from those due to age.</p>
<div class="frame">
<p><strong>Control on the front-end</strong></p>
<p>If we haven’t collected the data yet, one option would be to <strong>control by design</strong>. We try to collect our data such that caffeine consumption is <em>independent</em> from age. We could do this by <strong>randomisation</strong> (randomly allocate people to different levels of caffeine consumption, meaning that the age should not be related to caffeine - this is what a “randomized control trial” does, randomly allocating people to take a drug or a placebo).<br>
Alternatively, we could do achieve it by <strong>“case-matching”</strong> (easier when we are talking about 2 groups: e.g.&nbsp;for every 60 year old taking the drug, we also measure a 60 year old taking the placebo).</p>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">38</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">rdunif</span>(<span class="dv">100</span>,<span class="dv">40</span>,<span class="dv">80</span>),</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">caffeine =</span> <span class="dv">150</span> <span class="sc">+</span> age<span class="sc">*-</span>.<span class="dv">8</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">100</span>,<span class="dv">0</span>,<span class="dv">5</span>),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">rhr =</span> <span class="dv">56</span> <span class="sc">+</span> age<span class="sc">*</span>.<span class="dv">3</span> <span class="sc">+</span> <span class="dv">0</span><span class="sc">*</span>caffeine <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">100</span>,<span class="dv">0</span>,<span class="dv">5</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(rhr <span class="sc">~</span> caffeine, <span class="at">data =</span> df))<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Estimate Std. Error   t value     Pr(&gt;|t|)
(Intercept) 101.17457 5.34239607 18.938052 1.610622e-34
caffeine     -0.25999 0.05270223 -4.933189 3.309000e-06</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(rhr <span class="sc">~</span> age <span class="sc">+</span> caffeine, <span class="at">data =</span> df))<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               Estimate Std. Error  t value     Pr(&gt;|t|)
(Intercept) 41.83101855 16.0000237 2.614435 0.0103629152
age          0.39137193  0.1002531 3.903838 0.0001749053
caffeine     0.09330257  0.1030299 0.905587 0.3673983833</code></pre>
</div>
</div>
<p>The toy dataset for our heart rate and caffeine example is at [TODO LINK].<br>
We can see plots of the different relationships in <a href="#fig-caffplot">Figure&nbsp;2</a>. It looks from these like heart rate <em>decreases</em> with caffeine, and <em>increases</em> with age. But note also that caffeine decreases with age.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-caffplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="08a_mlr_files/figure-html/fig-caffplot-1.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Figure 2: bi-variate relationships between each of resting heart rate, caffeine consumption, and age</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>fit lm rhr ~ caff oh look, a nice line! significant. more caffeine is associated with lower heart rate!</p>
<p>but what if the reason that people in our sample who drink more caff have lower hr not because they drink more caff, but because they are older (and older people have lower hr).</p>
<p>The coefficient for the association between caffeine and heart rate when we <em>also</em> include age in as a predictor (<code>lm(rhr ~ age + caffeine)</code>), is no longer significant. Why? Because after we take into account how old people are, their caffeine consumption doesn’t actually provide any information about their heart rate.</p>
<p>This example is a very extreme one where the relationship completely disappears. in real data associations tend to be more subtle/less clear cut. Including a covariate <span class="math inline">\(x_2\)</span> may increase or decrease the association between <span class="math inline">\(y\)</span> and <span class="math inline">\(x_1\)</span>, depending on the extent to which <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span> are correlated.</p>
</div>
<p>optional good bad control</p>
<p>line &gt; surface if we have categorical, then line &gt; two lines</p>
</section>
<section id="fitting-multiple-regression-models" class="level1">
<h1>fitting multiple regression models</h1>
<p>lm</p>
</section>
<section id="multiple-categories-multiple-regression" class="level1">
<h1>multiple categories = multiple regression</h1>
</section>
<section id="model-evaluation" class="level1">
<h1>Model Evaluation</h1>
<section id="adjusted-r2" class="level2">
<h2 class="anchored" data-anchor-id="adjusted-r2">Adjusted <span class="math inline">\(R^2\)</span></h2>
<p>We know from our work on simple linear regression that the R-squared can be obtained as:</p>
<p><span class="math display">\[
R^2 = \frac{SS_{Model}}{SS_{Total}} = 1 - \frac{SS_{Residual}}{SS_{Total}}
\]</span></p>
<p>If we briefly return to the venn diagrams we used above, the <span class="math inline">\(R^2\)</span> is capturing all variance in <span class="math inline">\(y\)</span> that is explained by the predictors (including the overlapping bits between <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span>).<br>
TODO</p>
<p>r2 venn</p>
<p>However, when we add more and more predictors into a multiple regression model, <span class="math inline">\(SS_{Residual}\)</span> cannot increase, and may decrease by pure chance alone, even if the predictors are unrelated to the outcome variable. Because <span class="math inline">\(SS_{Total}\)</span> is constant, the calculation <span class="math inline">\(1-\frac{SS_{Residual}}{SS_{Total}}\)</span> will increase by chance alone.</p>
<p>An alternative, the Adjusted-<span class="math inline">\(R^2\)</span>, does not necessarily increase with the addition of more explanatory variables, by including a penalty according to the number of explanatory variables in the model. It is not by itself meaningful, but can be useful in determining what predictors to include in a model.</p>
<p><span class="math display">\[
Adjusted{-}R^2=1-\frac{(1-R^2)(n-1)}{n-k-1} \\
\quad \\
\begin{align}
&amp; \text{Where:} \\
&amp; n = \text{sample size} \\
&amp; k = \text{number of explanatory variables} \\
\end{align}
\]</span></p>
<p><strong>In R,</strong> you can view the mutiple and adjusted <span class="math inline">\(R^2\)</span> at the bottom of the output of <code>summary(&lt;modelname&gt;)</code>:</p>
<p>TODO</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-mlroutputrsq" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/mlr/mlroutputrsq.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Figure 3: Multiple regression output in R, summary.lm(). R-squared highlighted</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="joint-test" class="level2">
<h2 class="anchored" data-anchor-id="joint-test">Joint test</h2>
<p>As in simple linear regression, the F-statistic is used to test the null hypothesis that <strong>all</strong> regression slopes are zero (it is just that now that we have multiple predictors, so “all” is more than 1).</p>
<p><span class="math display">\[
\begin{aligned}
H_0: &amp; \text{the model is ineffective, } \\
&amp; b_1, ..., b_k = 0 \\
H_1: &amp;\text{the model is effective, } \\
&amp; \text{any of }b_1, ..., b_k \neq 0
\end{aligned}
\]</span></p>
<p>The <span class="math inline">\(F\)</span>-statistic is sometimes called the F-ratio because it is the ratio of the how much of the variation is explained by the model (per parameter) versus how much of the variation is unexplained (per remaining degrees of freedom).</p>
<p>We extend the formula for the <span class="math inline">\(F\)</span>-statistic for simple regression to encompass situations where there are more predictors:</p>
<p><span class="math display">\[
\begin{align}
&amp; F_{df_{model},df_{residual}} = \frac{MS_{Model}}{MS_{Residual}} = \frac{SS_{Model}/df_{Model}}{SS_{Residual}/df_{Residual}} \\
&amp; \quad \\
&amp; \text{Where:} \\
&amp; df_{model} = k \\
&amp; df_{error} = n-k-1 \\
&amp; n = \text{sample size} \\
&amp; k  = \text{number of explanatory variables} \\
\end{align}
\]</span></p>
<p><strong>In R,</strong> at the bottom of the output of <code>summary(&lt;modelname&gt;)</code>, you can view the F ratio, along with an hypothesis test against the alternative hypothesis that the at least one of the coefficients <span class="math inline">\(\neq 0\)</span> (under the null hypothesis that all coefficients = 0, the ratio of explained:unexplained variance should be approximately 1):</p>
<p>TODO</p>
<div class="cell" data-layout-align="left">
<div class="cell-output-display">
<div id="fig-mlroutputrf" class="quarto-figure quarto-figure-left anchored">
<figure class="figure">
<p><img src="images/mlr/mlroutputf.png" class="img-fluid figure-img" style="width:80.0%"></p>
<p></p><figcaption class="figure-caption">Figure 4: Multiple regression output in R, summary.lm(). F statistic highlighted</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="model-comparisons" class="level1">
<h1>Model Comparisons</h1>
<p>The <span class="math inline">\(F\)</span>-statistic we see at the bottom of <code>summary(model)</code> is actually a comparison between two models: our model (with some explanatory variables in predicting <span class="math inline">\(y\)</span>) and <strong>the null model.</strong> In regression, the null model can be thought of as the model in which all explanatory variables have zero regression coefficients. It is also referred to as the <strong>intercept-only model</strong>, because if all predictor variable coefficients are zero, then the only we are only estimating <span class="math inline">\(y\)</span> via an intercept (which will be the mean: <span class="math inline">\(\bar y\)</span>).</p>
<p>But we don’t always have to compare our model to the null model. We can compare it to all the intermediate models which vary in the complexity, from the null model to our full model.</p>
<div class="imp">
<p>If (<em>and only if</em>) two models are <strong>nested</strong> (one model contains all the predictors of the other and is fitted to the same data), we can compare them using an <strong>incremental F-test.</strong></p>
</div>
<div class="statbox">
<p><strong>Incremental F-test</strong></p>
<p>This is a formal test of whether the additional predictors provide a better fitting model.<br>
Formally this is the test of:</p>
<ul>
<li><span class="math inline">\(H_0:\)</span> coefficients for the added/ommitted variables are all zero.</li>
<li><span class="math inline">\(H_1:\)</span> at least one of the added/ommitted variables has a coefficient that is not zero.</li>
</ul>
<div class="rtip">
<p><strong>In R,</strong> we can conduct an incremental F-test by constructing two models, and passing them to the <code>anova()</code> function: <code>anova(model1, model2)</code>.</p>
</div>
<div class="optional-begin">
<span id="opt-start-2" class="fa fa-hand-o-right optional-icon clickable" onclick="toggle_visibility('opt-body-2', 'opt-start-2')"> <span class="olab">Optional: F-ratio written for model comparison</span></span>
</div>
<div id="opt-body-2" class="optional-body" style="display: none;">
<p>The F-ratio for comparing the residual sums of squares between two models can be written as:</p>
<p><span class="math display">\[
\begin{align}
&amp; F_{(df_R-df_F),df_F} = \frac{(SSR_R-SSR_F)/(df_R-df_F)}{SSR_F / df_F} \\
&amp; \quad \\
&amp; \text{Where:} \\
&amp; SSR_R = \text{residual sums of squares for the restricted model} \\
&amp; SSR_F = \text{residual sums of squares for the full model} \\
&amp; df_R = \text{residual degrees of freedom from the restricted model} \\
&amp; df_F = \text{residual degrees of freedom from the full model} \\
\end{align}
\]</span></p>
</div>
<p class="optional-end">
</p>
</div>
<p>To fit the ‘null model’, we simply fit the model with only an intercept term, and no predictors. We can use the <code>anova()</code> function to compare this model with ours, and we will see that it matches the <span class="math inline">\(F\)</span>-statistic at the bottom of the full model output.</p>
<p>TODO</p>
<div class="cell" data-layout-align="center">

</div>
</section>
<section id="types-of-ss" class="level1">
<h1>Types of SS</h1>
<p>todo borrow from explainer doc 2122?</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>