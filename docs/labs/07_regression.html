<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Linear Regression</title>

<script src="site_libs/header-attrs-2.8/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/united.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<script>
function toggle_visibility(id1, id2) {
var e = document.getElementById(id1);
var f = document.getElementById(id2);
e.style.display = ((e.style.display!='none') ? 'none' : 'block');
if(f.classList.contains('fa-chevron-circle-right')) {
    f.classList.add('fa-chevron-circle-down')
    f.classList.remove('fa-chevron-circle-right')
} else {
    f.classList.add('fa-chevron-circle-right')
    f.classList.remove('fa-chevron-circle-down')
}
}
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="assets/style-labs.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="https://uoepsy.github.io/usmr/">
    <span class="fas fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    USMR Starts Here!
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="00_introPG.html">Getting started with R &amp; RStudio</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data &amp; Distributions
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="01_categorical.html">1: Categorical Data</a>
    </li>
    <li>
      <a href="02_numerical.html">2: Numeric Data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tests, Models &amp; Data Wrangling
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="03_nhst.html">3: Hypothesis testing</a>
    </li>
    <li>
      <a href="04_tests.html">4: More tests</a>
    </li>
    <li>
      <a href="05_covcor.html">5: Cov, Cor, Functions &amp; Models</a>
    </li>
    <li class="dropdown-header">--- 6: Break Week ---</li>
    <li>
      <a href="06_messy.html">7: Messy data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Regression models
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="07_regression.html">8: Linear Regression</a>
    </li>
    <li>
      <a href="08_regression2.html">9: More Linear Regression</a>
    </li>
    <li class="dropdown-header">10: GLM!</li>
    <li class="dropdown-header">11: Writing up</li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Extras
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="zz_assumpt.html">LM Assumptions: Recipe book</a>
    </li>
    <li>
      <a href="zz_incrementalvalidity.html">Incremental Validity: A Caution</a>
    </li>
    <li>
      <a href="zz_ss.html">Sums of Squares</a>
    </li>
    <li>
      <a href="zz_modelselect.html">Model Selection</a>
    </li>
  </ul>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Linear Regression</h1>

</div>


<!-- w7 -->
<!-- correlation ++ -->
<!-- significance -->
<!--   - coefficients -->
<!-- - F, R^2 -->
<!-- w8 -->
<!-- - assumptions & diagnostics -->
<!-- - multiple regression -->
<!-- - model comparison -->
<!-- - SS types -->
<!-- # Regression introduction -->
<!-- - write out model, consider hypotheses -->
<!-- - first explore the data -->
<!-- - fitting a model -->
<!-- - interpreting coefficients -->
<!-- - interpreting sigma -->
<!-- - fitted and predicted values -->
<!-- # Inference for regression coefficients -->
<!-- # Model Fit: -->
<!--  - partitioning variation -->
<!--  - testing model utility -->
<!-- # A categorical predictor -->
<!--  - (this will be covered in week 9 lecture, but the general idea is) -->
<!-- # extending to multiple predictors -->
<!-- ## ~ numeric + numeric -->
<!-- # assumptions -->
<!-- # choose > fit > assess > use -->
<!-- optbegin: a recipe book: LINE -->
<!--   ## linearity -->
<!--   ## equal variances -->
<!--   ## independence -->
<!--   ## normality of errors -->
<!-- # the general idea -->
<!-- # multicollinearity -->
<!-- # diagnostics -->
<!-- ## individual cases -->
<!-- ## other influence.measures() -->
<div class="lo">
<div style="width:60%; display: inline-block;">
<p>This lab is a long one! It takes us quite slowly through simple and multiple regression, but the broader ideas being introduced are actually quite simple - we are just drawing a straight line through some datapoints!<br />
Try to take regular breaks during these exercises. This will help (a bit) with not getting overwhelmed - these things (both the statistics side and the programming side) take time - and repeated practice - to sink in.</p>
</div>
<div style="width:30%; display: inline-block; vertical-align: top">
<p><img src="images/slr/catworking.gif" width="80%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="simple-regression" class="section level1">
<h1>Simple regression</h1>
<div class="frame">
<p><strong>Data: riverview.csv</strong></p>
<p>Let’s imagine a study into income disparity for workers in a local authority. We might carry out interviews and find that there is a link between the level of education and an employee’s income. Those with more formal education seem to be better paid.
Now we wouldn’t have time to interview everyone who works for the local authority so we would have to interview a sample, say 10%.</p>
<p>In this next set of exercises we will use the riverview data, which come from <a href="https://methods.sagepub.com/book/applied-regression-an-introduction-second-edition">Lewis-Beck, 2015</a> and contain five attributes collected from a random sample of <span class="math inline">\(n=32\)</span> employees working for the city of Riverview, a hypothetical midwestern city in the US. The attributes include:</p>
<ul>
<li><code>education</code>: Years of formal education</li>
<li><code>income</code>: Annual income (in thousands of U.S. dollars)</li>
<li><code>seniority</code>: Years of seniority</li>
<li><code>gender</code>: Employee’s gender</li>
<li><code>male</code>: Dummy coded gender variable (0 = Female, 1 = Male)</li>
<li><code>party</code>: Political party affiliation</li>
</ul>
<p><strong>Preview</strong></p>
<p>The first six rows of the data are:</p>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
education
</th>
<th style="text-align:center;">
income
</th>
<th style="text-align:center;">
seniority
</th>
<th style="text-align:center;">
gender
</th>
<th style="text-align:center;">
male
</th>
<th style="text-align:center;">
party
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
8
</td>
<td style="text-align:center;">
37.449
</td>
<td style="text-align:center;">
7
</td>
<td style="text-align:center;">
male
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
Democrat
</td>
</tr>
<tr>
<td style="text-align:center;">
8
</td>
<td style="text-align:center;">
26.430
</td>
<td style="text-align:center;">
9
</td>
<td style="text-align:center;">
female
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
Independent
</td>
</tr>
<tr>
<td style="text-align:center;">
10
</td>
<td style="text-align:center;">
47.034
</td>
<td style="text-align:center;">
14
</td>
<td style="text-align:center;">
male
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
Democrat
</td>
</tr>
<tr>
<td style="text-align:center;">
10
</td>
<td style="text-align:center;">
34.182
</td>
<td style="text-align:center;">
16
</td>
<td style="text-align:center;">
female
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
Independent
</td>
</tr>
<tr>
<td style="text-align:center;">
10
</td>
<td style="text-align:center;">
25.479
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
female
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
Republican
</td>
</tr>
<tr>
<td style="text-align:center;">
12
</td>
<td style="text-align:center;">
46.488
</td>
<td style="text-align:center;">
11
</td>
<td style="text-align:center;">
female
</td>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
Democrat
</td>
</tr>
</tbody>
</table>
<p>The data is available at <a href="https://uoepsy.github.io/data/riverview.csv" target="_blank">https://uoepsy.github.io/data/riverview.csv.</a></p>
</div>
<div class="question-begin">
Question A1
</div>
<div class="question-body">
<p>Load the required libraries (probably just <strong>tidyverse</strong> for now), and read in the riverview data to your R session.<br />
I’m going to name it <code>riverview</code> in my environment.</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-93" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-93&#39;, &#39;sol-start-93&#39;)"> Solution </span>
</div>
<div id="sol-body-93" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>riverview <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;https://uoepsy.github.io/data/riverview.csv&quot;</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(riverview)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##   education income seniority gender  male party      
##       &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;      
## 1         8   37.4         7 male       1 Democrat   
## 2         8   26.4         9 female     0 Independent
## 3        10   47.0        14 male       1 Democrat   
## 4        10   34.2        16 female     0 Independent
## 5        10   25.5         1 female     0 Republican 
## 6        12   46.5        11 female     0 Democrat</code></pre>
</div>
<p class="solution-end">
</p>
<div id="exploring-the-data" class="section level2">
<h2>Exploring the data</h2>
<div class="statbox">
<p>Probably the first port of call for almost any statistical analysis is to just explore the data and make sure that things look as you would expect them to look. We can do this visually, or numerically, using the skills we saw in weeks 1 and 2.</p>
</div>
<div class="question-begin">
Question A2
</div>
<div class="question-body">
<p>Let us first visualise and describe the <em>marginal distributions</em> of those variables which are of interest to us.
These are the distribution of each variable (employee incomes and education levels) <em>without</em> reference to the values of the other variables.</p>
<ul>
<li>You could use, for example, <code>geom_density()</code> for a density plot or <code>geom_histogram()</code> for a histogram.</li>
<li>Look at the shape, center and spread of the distribution. Is it symmetric or skewed? Is it unimodal or bimodal?</li>
<li>Do you notice any extreme observations?</li>
</ul>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-94" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-94&#39;, &#39;sol-start-94&#39;)"> Solution </span>
</div>
<div id="sol-body-94" class="solution-body" style="display: none;">
<p>We can plot the marginal distribution of employee incomes as a density curve, and add a boxplot underneath to check for the presence of outliers.</p>
<p>The <code>width</code> of the geom_boxplot() is always quite wide, so I want to make it narrower so that we can see it at the same time as the density plot. Deciding on the exact value for the width here is just trial and error.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> riverview, <span class="fu">aes</span>(<span class="at">x =</span> income)) <span class="sc">+</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>() <span class="sc">+</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">300</span>) <span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Income (in thousands of U.S. dollars)&quot;</span>, </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Probability density&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-4"></span>
<img src="07_regression_files/figure-html/unnamed-chunk-4-1.png" alt="Density plot and boxplot of employee incomes." width="80%" />
<p class="caption">
Figure 1: Density plot and boxplot of employee incomes.
</p>
</div>
<p>The plot suggests that the distribution of employee incomes is unimodal and most of the incomes are between roughly $45,000 and $70,000.
The smallest income in the sample is about $25,000 and the largest income is over $80,000. (We could find the exact values using the <code>summary()</code> function).
This suggests there is a fair amount of variation in the data.
Furthermore, the boxplot does not highlight any outliers in the data.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> riverview, <span class="fu">aes</span>(<span class="at">x =</span> education)) <span class="sc">+</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>() <span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Education (in years)&quot;</span>, </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Probability density&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-5"></span>
<img src="07_regression_files/figure-html/unnamed-chunk-5-1.png" alt="Density plot and boxplot of employee education levels." width="80%" />
<p class="caption">
Figure 2: Density plot and boxplot of employee education levels.
</p>
</div>
<p>To further summarize a distribution, it is typical to compute and report numerical summary statistics such as the mean and standard deviation. One way to compute these values is to use the <code>summarise()/summarize()</code> function from the <code>tidyverse</code> library:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>riverview <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">e =</span> <span class="fu">mean</span>(income), </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_income =</span> <span class="fu">sd</span>(income),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_edu =</span> <span class="fu">mean</span>(education),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_edu =</span> <span class="fu">sd</span>(education)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<pre><code>## # A tibble: 1 × 4
##       e sd_income mean_edu sd_edu
##   &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
## 1  53.7      14.6       16   4.36</code></pre>
<div class="int">
<p>The marginal distribution of income is unimodal with a mean of approximately $53,700. There is variation in employees’ salaries (SD = $14,553).<br />
The marginal distribution of education is unimodal with a mean of 16 years. There is variation in employees’ level of education (SD = 4.4 years).</p>
</div>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question A3
</div>
<div class="question-body">
<p>After we’ve looked at the marginal distributions of the variables of interest in the analysis, we typically move on to examining <em>relationships</em> between the variables.</p>
<p>Visualise and describe (just in words) the relationship between income and level of education among the employees in the sample.</p>
<p>Think about:</p>
<ul>
<li><em>Direction</em> of association</li>
<li><em>Form</em> of association (can it be summarised well with a straight line?)<br />
</li>
<li><em>Strength</em> of association (how closely do points fall to a recognizable pattern such as a line?)</li>
<li><em>Unusual observations</em> that do not fit the pattern of the rest of the observations and which are worth examining in more detail.</li>
</ul>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-95" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-95&#39;, &#39;sol-start-95&#39;)"> Solution </span>
</div>
<div id="sol-body-95" class="solution-body" style="display: none;">
<p>We are trying to investigate how income varies when varying years of formal education.
Hence income is the dependent variable (on the y-axis), and education is the independent variable (on the x-axis).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> riverview, <span class="fu">aes</span>(<span class="at">x =</span> education, <span class="at">y =</span> income)) <span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Education (in years)&quot;</span>, </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Income (in thousands of U.S. dollars)&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:riverview-scatterplot"></span>
<img src="07_regression_files/figure-html/riverview-scatterplot-1.png" alt="The relationship between employees' education level and income." width="80%" />
<p class="caption">
Figure 3: The relationship between employees’ education level and income.
</p>
</div>
<p>We might write:</p>
<div class="int">
<p>There is a strong positive linear relationship between education level and income for the employees in the sample.
High incomes tend to be observed, on average, with more years of formal education.
The scatterplot does not highlight any outliers.</p>
</div>
</div>
<p class="solution-end">
</p>
<div class="frame">
<p>To comment numerically on the strength of the linear association we might compute the correlation coefficient that we were introduced to in <a href="05_covcor.html">Week 5</a>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>riverview <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(education, income) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>()</span></code></pre></div>
<pre><code>##           education    income
## education 1.0000000 0.7947847
## income    0.7947847 1.0000000</code></pre>
<p>that is,
<span class="math display">\[
r_{\text{education, income}} = 0.79
\]</span></p>
</div>
</div>
<div id="fitting-a-linear-model" class="section level2">
<h2>Fitting a Linear Model</h2>
<!-- :::statbox -->
<!-- **A note on notation**   -->
<!-- You will see a variety of different ways of specifying the linear model form in different resources.   -->
<!-- Some use $\beta$, some use $b$.   -->
<!-- In the lectures, you have seen the form $\color{red}{y} = \color{blue}{b_0 \cdot{} 1 + b_1 \cdot{} x} + \epsilon$.   -->
<!-- In the exercises below, we will tend to use $\color{red}{Y} = \color{blue}{\beta_0 \cdot{} 1 + \beta_1 \cdot{} X} + \epsilon$, to denote our population model, which when fitted on some sample data becomes $\color{red}{\hat{Y}} = \color{blue}{\hat{\beta}_0 \cdot{} 1 + \hat{\beta_1} \cdot{} X} + \hat{\epsilon}$ (the little hats indicate that they are fitted estimates).   -->
<!-- ::: -->
<div class="frame">
<p>The plot created in the previous question highlights a linear relationship, where the data points are scattered around an underlying linear pattern with a roughly-constant spread as x varies.</p>
<p>We will try to fit a simple (one explanatory variable only) linear regression model:</p>
<p><span class="math display">\[
Income = b_0 + b_1 \ Education + \epsilon \quad \\
\text{where} \quad \epsilon \sim N(0, \sigma) \text{ independently}
\]</span></p>
<p>where “<span class="math inline">\(\epsilon \sim N(0, \sigma) \text{ independently}\)</span>” means that the errors around the line have mean zero and constant spread as x varies (we’ll read more about what this means later in this lab in the section on <a href="#making">Making Valid Inferences</a>).</p>
<div class="rtip">
<p>To fit linear models, we use the <code>lm()</code> function.<br />
The syntax of the <code>lm()</code> function is:</p>
<pre><code>[model name] &lt;- lm([response variable] ~ 1 + [explanatory variable], data = [dataframe])</code></pre>
</div>
</div>
<div class="rtip">
<p><strong>Why <code>~1</code>?</strong></p>
<p>The fitted model can be written as
<span class="math display">\[
\hat y = \hat b_0 + \hat b_1 (x)
\]</span>
The predicted values for the outcome are equal to our intercept, <span class="math inline">\(\hat b_0\)</span>, plus our slope <span class="math inline">\(\hat b_1\)</span> multiplied by the value on our explanatory variable <span class="math inline">\(x\)</span>.<br />
The intercept is a <em>constant</em>. That is, we could write it as multiplied by 1:
<span class="math display">\[
\hat y = \color{blue}{\hat b_0}(\color{green}{1})\color{blue}{ + \hat b_1 }(\color{green}{x})
\]</span></p>
<p>When we specify the linear model in R, we include after the tilde sign <code>~</code> all the things which appear to the right of each of the <span class="math inline">\(\hat b\)</span>s (the bits in green in the equartion above). That’s why the 1 is included. It is just saying “we want the intercept, <span class="math inline">\(b_0\)</span>, to be estimated.”</p>
</div>
<div class="question-begin">
Question A4
</div>
<div class="question-body">
<p>Using the <code>lm()</code> function, fit a linear model to the sample data, in which employee income is explained by education level. Assign it to a name to store it in your environment.</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-96" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-96&#39;, &#39;sol-start-96&#39;)"> Solution </span>
</div>
<div id="sol-body-96" class="solution-body" style="display: none;">
<p>As the variables are in the <code>riverview</code> dataframe, we would write:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(income <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> education, <span class="at">data =</span> riverview)</span></code></pre></div>
</div>
<p class="solution-end">
</p>
</div>
<div id="interpreting-coefficients" class="section level2">
<h2>Interpreting coefficients</h2>
<div class="question-begin">
Question A5
</div>
<div class="question-body">
<p>Interpret the estimated intercept and slope in the context of the question of interest.</p>
<p>Let’s suppose we assigned our linear model object to the name “model1” in R. To obtain the estimated regression coefficients we can use it’s name in various ways and with various functions.</p>
<ul>
<li>type <code>model1</code>, i.e. simply invoke the name of the fitted model;</li>
<li>type <code>model1$coefficients</code>;</li>
<li>use the <code>coef(model1)</code> function;</li>
<li>use the <code>coefficients(model1)</code> function;</li>
<li>use the <code>summary(model1)</code> function and look under the “Estimate” column.</li>
</ul>
<p>The estimated parameters returned by the above methods are all equivalent. However, <code>summary()</code> returns more information and you need to look under the column “Estimate.”</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-97" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-97&#39;, &#39;sol-start-97&#39;)"> Solution </span>
</div>
<div id="sol-body-97" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(model1)</span></code></pre></div>
<pre><code>## (Intercept)   education 
##   11.321379    2.651297</code></pre>
<p>The fitted line is:
<span class="math display">\[
\widehat{Income} = 11.32 + 2.65 \ Education \\
\]</span></p>
<p>We can interpret the estimated intercept as follows,</p>
<div class="int">
<p>The estimated average income associated with zero years of formal education is $11,321.</p>
</div>
<p>For the estimated slope we might write,</p>
<div class="int">
<p>The estimated increase in average income associated with a one year increase in education is $2,651.</p>
</div>
</div>
<p class="solution-end">
</p>
</div>
<div id="interpreting-sigma" class="section level2">
<h2>Interpreting <span class="math inline">\(\sigma\)</span></h2>
<div class="statbox">
<p>The parameter estimates from our simple linear regression model take the form of a line, representing the systematic part of our model <span class="math inline">\(b_0 + b_1 \ x\)</span>, which in our case is <span class="math inline">\(11.32 + 2.65 \ Education\)</span>. Deviations from the line are determined by the random error component <span class="math inline">\(\hat \epsilon\)</span>, or “residuals” (the red lines in Figure <a href="#fig:figslr">4</a> below).</p>
<div class="figure" style="text-align: center"><span id="fig:figslr"></span>
<img src="07_regression_files/figure-html/figslr-1.png" alt="Simple linear regression model, with systematic part of the model in blue and residuals in red" width="80%" />
<p class="caption">
Figure 4: Simple linear regression model, with systematic part of the model in blue and residuals in red
</p>
</div>
<p>We use <span class="math inline">\(\sigma\)</span> to denote the standard deviation of all the residuals</p>
</div>
<div class="question-begin">
Question A6
</div>
<div class="question-body">
<p>Consider the following:</p>
<ol style="list-style-type: decimal">
<li>In fitting a linear regression model, we make the assumption that the errors around the line are normally distributed around zero (this is the <span class="math inline">\(\epsilon \sim N(0, \sigma)\)</span> bit.)<br />
</li>
<li>About 95% of values from a normal distribution fall within two standard deviations of the centre.</li>
</ol>
<p>We can obtain the estimated standard deviation of the errors (<span class="math inline">\(\hat \sigma\)</span>) from the fitted model using <code>sigma()</code> and giving it the name of our model.<br />
What does this tell us?</p>
<div class="optional-begin">
<span id="opt-start-98" class="fa fa-chevron-circle-right optional-icon clickable" onclick="toggle_visibility(&#39;opt-body-98&#39;, &#39;opt-start-98&#39;)"> Huh? What is <span class="math inline">\(\sigma\)</span>?</span>
</div>
<div id="opt-body-98" class="optional-body" style="display: none;">
<p>The standard deviation of the errors, denoted by <span class="math inline">\(\sigma\)</span> is an important quantity to estimate because it measures how much individual data points tend to deviate above and below the regression line.</p>
<p>A small <span class="math inline">\(\sigma\)</span> indicates that the points hug the line closely and we should expect fairly accurate predictions, while a large <span class="math inline">\(\sigma\)</span> suggests that, even if we estimate the line perfectly, we can expect individual values to deviate from it by substantial amounts.</p>
<p>When we actually <strong>estimate</strong> this quantity, we might put a hat on it, and write <span class="math inline">\(\hat \sigma\)</span>. It is equal to
<span class="math display">\[
\hat \sigma = \sqrt{\frac{SS_{Residual}}{n - 2}} \\
\begin{align}
&amp; \text{where} \\
&amp; SS_{Residual} = \textrm{Sum of Squared Residuals} = \sum_{i=1}^n{(\epsilon_i)^2}
\end{align}
\]</span></p>
</div>
<p class="optional-end">
</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-99" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-99&#39;, &#39;sol-start-99&#39;)"> Solution </span>
</div>
<div id="sol-body-99" class="solution-body" style="display: none;">
<p>The estimated standard deviation of the errors can be equivalently obtained by:</p>
<ul>
<li>typing <code>sigma(model1)</code>;</li>
<li>looking at the “Residual standard error” entry of the <code>summary(model1)</code> output.</li>
</ul>
<p><em><strong>Note:</strong> The term “Residual standard error” is a misnomer, as the help page for <code>sigma</code> says (check <code>?sigma</code>). However, it’s hard to get rid of this bad name as it has been used in too many books showing R output.</em></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sigma</span>(model1)</span></code></pre></div>
<pre><code>## [1] 8.978116</code></pre>
<div class="int">
<p>For any particular level of education, employee incomes should be distributed above and below the regression line with standard deviation estimated to be <span class="math inline">\(\hat \sigma = 8.98\)</span>.
Since <span class="math inline">\(2 \hat \sigma = 2 (8.98) = 17.96\)</span>, we expect most (about 95%) of the employee incomes to be within about $18,000 from the regression line.</p>
</div>
</div>
<p class="solution-end">
</p>
</div>
<div id="fitted-and-predicted-values" class="section level2">
<h2>Fitted and predicted values</h2>
<div class="rtip">
<p>To compute the model-predicted values for the data in the sample we can use various functions. Again, if our model object is named “model1” in our environment, we can use:</p>
<ul>
<li><code>predict(model1)</code></li>
<li><code>fitted(model1)</code></li>
<li><code>fitted.values(model1)</code></li>
<li><code>model1$fitted.values</code></li>
</ul>
<p>For example, this will give us the estimated income (point on our regression line) for each observed value of education level.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(model1)</span></code></pre></div>
<pre><code>##        1        2        3        4        5        6        7        8 
## 32.53175 32.53175 37.83435 37.83435 37.83435 43.13694 43.13694 43.13694 
##        9       10       11       12       13       14       15       16 
## 43.13694 48.43953 48.43953 48.43953 51.09083 53.74212 53.74212 53.74212 
##       17       18       19       20       21       22       23       24 
## 53.74212 53.74212 56.39342 59.04472 59.04472 61.69601 61.69601 64.34731 
##       25       26       27       28       29       30       31       32 
## 64.34731 64.34731 64.34731 66.99861 66.99861 69.64990 69.64990 74.95250</code></pre>
<p>We can also compute model-predicted values for other (unobserved) data:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make a tibble/dataframe with values for the predictor:</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>education_query <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">education =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">18</span>, <span class="dv">50</span>))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># model predicted values of income, for the values of education</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># inside the &quot;education_query&quot; data</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(model1, <span class="at">newdata =</span> education_query)</span></code></pre></div>
<pre><code>##         1         2         3 
##  40.48564  59.04472 143.88621</code></pre>
</div>
<div class="question-begin">
Question A7
</div>
<div class="question-body">
<p>Compute the model-predicted income for someone with 1 year of education.</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-100" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-100&#39;, &#39;sol-start-100&#39;)"> Solution </span>
</div>
<div id="sol-body-100" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>education_query <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">education =</span> <span class="fu">c</span>(<span class="dv">1</span>))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(model1, <span class="at">newdata =</span> education_query)</span></code></pre></div>
<pre><code>##        1 
## 13.97268</code></pre>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question A8
</div>
<div class="question-body">
<p>Given that our fitted model takes the form:</p>
<p><span class="math display">\[
Income = 11.32 + 2.65\cdot Education
\]</span>
How can we get to this same answer manually?</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-101" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-101&#39;, &#39;sol-start-101&#39;)"> Solution </span>
</div>
<div id="sol-body-101" class="solution-body" style="display: none;">
<p>We are asking what the predicted income is for someone with 1 year of education. So we can substitute in “1” for the Education variable:
<span class="math display">\[
\begin{align}
Income &amp;= 11.32 + 2.65\cdot Education \\
Income &amp;= 11.32 + 2.65\cdot 1 \\
Income &amp;= 11.32 + 2.65\\
Income &amp;= 13.97 \\
\end{align}
\]</span></p>
</div>
<p class="solution-end">
</p>
</div>
<div id="inference-for-regression-coefficients" class="section level2">
<h2>Inference for regression coefficients</h2>
<div class="statbox">
We have fitted a linear model, and we now know how we interpret our coefficients. But this is only part of the story.
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-14"></span>
<img src="images/slr/conv1.png" alt="Estimates without inference" width="80%" />
<p class="caption">
Figure 5: Estimates without inference
</p>
</div>
<p>To quantify the amount of uncertainty in each estimated coefficient that is due to sampling variability, we use the standard error (SE) of the coefficient.
<em>Recall that a standard error gives a numerical answer to the question of how variable a statistic will be because of random sampling.</em></p>
<p>The standard errors are found in the column “Std. Error” of the <code>summary()</code> of a model:</p>
<pre><code>##              Estimate Std. Error  t value     Pr(&gt;|t|)
## (Intercept) 11.321379  6.1232350 1.848921 7.434602e-02
## education    2.651297  0.3696232 7.172972 5.562116e-08</code></pre>
<p>In this example the slope, 2.651, has a standard error of 0.37. One way to envision this is as a distribution. Our best guess (mean) for the slope parameter is 2.651. The standard deviation of this distribution is 0.37, which indicates the precision (uncertainty) of our estimate.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-16"></span>
<img src="07_regression_files/figure-html/unnamed-chunk-16-1.png" alt="Sampling distribution of the slope coefficient. The distribution is approximately bell-shaped with a mean of 2.651 and a standard error of 0.37." width="80%" />
<p class="caption">
Figure 6: Sampling distribution of the slope coefficient. The distribution is approximately bell-shaped with a mean of 2.651 and a standard error of 0.37.
</p>
</div>
<p>We can perform a test against the null hypothesis that the estimate is zero. Our test statistic:
The reference distribution in this case is a t-distribution with <span class="math inline">\(n-2\)</span> degrees of freedom, where <span class="math inline">\(n\)</span> is the sample size, and our test statistic is:<br />
<span class="math display">\[
t = \frac{\hat b_1 - 0}{SE(\hat b_1)}
\]</span></p>
</div>
<div class="question-begin">
Question A9
</div>
<div class="question-body">
<p>Test the hypothesis that the population slope is zero — that is, that there is no linear association between income and education level in the population.</p>
<p>(Hint: you don’t need to <em>do</em> anything for this, you can find all the necessary information in <code>summary()</code> of your model)</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-102" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-102&#39;, &#39;sol-start-102&#39;)"> Solution </span>
</div>
<div id="sol-body-102" class="solution-body" style="display: none;">
<p>The information is already contained in the row corresponding to the variable “education” in the output of <code>summary()</code>, which reports the t-statistic under <code>t value</code> and the p-value under <code>Pr(&gt;|t|)</code>:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = income ~ 1 + education, data = riverview)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -15.809  -5.783   2.088   5.127  18.379 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  11.3214     6.1232   1.849   0.0743 .  
## education     2.6513     0.3696   7.173 5.56e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 8.978 on 30 degrees of freedom
## Multiple R-squared:  0.6317, Adjusted R-squared:  0.6194 
## F-statistic: 51.45 on 1 and 30 DF,  p-value: 5.562e-08</code></pre>
<p>Before we interpret the results, recall that the p-value <code>5.56e-08</code> in the <code>Pr(&gt;|t|)</code> column simply means <span class="math inline">\(5.56 \times 10^{-8}\)</span>. This is a very small value, hence we will report it as &lt;.001 following the APA guidelines.</p>
<div class="int">
<p>We performed a t-test against the null hypothesis that education is not a significant predictor of income: <span class="math inline">\(t(30) = 7.173,\ p &lt; .001\)</span>, two-sided.
The large t-statistic leads to a very small p-value, meaning that we have strong evidence against the null hypothesis.</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-18"></span>
<img src="images/slr/conv2.png" alt="conversations with statisticians" width="80%" />
<p class="caption">
Figure 7: conversations with statisticians
</p>
</div>
</div>
<p class="solution-end">
</p>
</div>
<div id="model-evaluation" class="section level2">
<h2>Model evaluation</h2>
<div class="statbox">
<p><strong>Partitioning variation: <span class="math inline">\(R^2\)</span></strong></p>
<p>We might ask ourselves if the model is useful. To quantify and assess model utility, we split the total variability of the response into two terms: the variability explained by the model plus the variability left unexplained in the residuals.</p>
<p><span class="math display">\[
\text{total variability in response = variability explained by model + unexplained variability in residuals}
\]</span></p>
<p>Each term is quantified by a sum of squares:</p>
<p><span class="math display">\[
\begin{aligned}
SS_{Total} &amp;= SS_{Model} + SS_{Residual} \\
\sum_{i=1}^n (y_i - \bar y)^2 &amp;= \sum_{i=1}^n (\hat y_i - \bar y)^2 + \sum_{i=1}^n (y_i - \hat y_i)^2 \\
\quad \\
\text{Where:} \\
y_i = \text{observed value} \\
\bar{y} = \text{mean} \\
\hat{y}_i = \text{model predicted value} \\
\end{aligned}
\]</span></p>
<p>The R-squared coefficient is defined as the proportion of the total variability in the outcome variable which is explained by our model:<br />
<span class="math display">\[
R^2 = \frac{SS_{Model}}{SS_{Total}} = 1 - \frac{SS_{Residual}}{SS_{Total}}
\]</span></p>
</div>
<div class="question-begin">
Question A10
</div>
<div class="question-body">
<p>What is the proportion of the total variability in incomes explained by the linear relationship with education level?</p>
<p><em><strong>Hint:</strong> The question asks to compute the value of <span class="math inline">\(R^2\)</span>, but you might be able to find it already computed somewhere (so much stuff is already in <code>summary()</code> of the model.</em></p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-103" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-103&#39;, &#39;sol-start-103&#39;)"> Solution </span>
</div>
<div id="sol-body-103" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = income ~ 1 + education, data = riverview)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -15.809  -5.783   2.088   5.127  18.379 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  11.3214     6.1232   1.849   0.0743 .  
## education     2.6513     0.3696   7.173 5.56e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 8.978 on 30 degrees of freedom
## Multiple R-squared:  0.6317, Adjusted R-squared:  0.6194 
## F-statistic: 51.45 on 1 and 30 DF,  p-value: 5.562e-08</code></pre>
<p>The output of <code>summary()</code> displays the R-squared value in the following line:</p>
<pre><code>Multiple R-squared:  0.6317</code></pre>
<p>For the moment, ignore “Adjusted R-squared.” We will come back to this later on.</p>
<div class="optional-begin">
<span id="opt-start-104" class="fa fa-chevron-circle-right optional-icon clickable" onclick="toggle_visibility(&#39;opt-body-104&#39;, &#39;opt-start-104&#39;)"> Optional - Manual calculation of R-Squared</span>
</div>
<div id="opt-body-104" class="optional-body" style="display: none;">
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>riverview_fitted <span class="ot">&lt;-</span> riverview <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">income_hat =</span> <span class="fu">predict</span>(model1),</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">resid =</span> income <span class="sc">-</span> income_hat</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(riverview_fitted)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 8
##   education income seniority gender  male party       income_hat  resid
##       &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;  &lt;dbl&gt;
## 1         8   37.4         7 male       1 Democrat          32.5   4.92
## 2         8   26.4         9 female     0 Independent       32.5  -6.10
## 3        10   47.0        14 male       1 Democrat          37.8   9.20
## 4        10   34.2        16 female     0 Independent       37.8  -3.65
## 5        10   25.5         1 female     0 Republican        37.8 -12.4 
## 6        12   46.5        11 female     0 Democrat          43.1   3.35</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>riverview_fitted <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">SSModel =</span> <span class="fu">sum</span>( (income_hat <span class="sc">-</span> <span class="fu">mean</span>(income))<span class="sc">^</span><span class="dv">2</span> ),</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">SSTotal =</span> <span class="fu">sum</span>( (income <span class="sc">-</span> <span class="fu">mean</span>(income))<span class="sc">^</span><span class="dv">2</span> )</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">RSquared =</span> SSModel <span class="sc">/</span> SSTotal</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   RSquared
##      &lt;dbl&gt;
## 1    0.632</code></pre>
</div>
<p class="optional-end">
</p>
<div class="int">
<p>Approximately 63% of the total variability in employee incomes is explained by the linear association with education level.</p>
</div>
</div>
<p class="solution-end">
</p>
<div class="statbox">
<p><strong>Testing Model Utility: <span class="math inline">\(F\)</span> Statistic</strong></p>
<p>To test if the model is useful — that is, if the explanatory variable is a useful predictor of the response — we test the following hypotheses:</p>
<p><span class="math display">\[
\begin{aligned}
H_0 &amp;: \text{the model is ineffective, } b_1 = 0 \\
H_1 &amp;: \text{the model is effective, } b_1 \neq 0
\end{aligned}
\]</span>
The relevant test-statistic is the F-statistic:</p>
<p><span class="math display">\[
\begin{split}
F = \frac{MS_{Model}}{MS_{Residual}} = \frac{SS_{Model} / 1}{SS_{Residual} / (n-2)}
\end{split}
\]</span></p>
<p>which compares the amount of variation in the response explained by the model to the amount of variation left unexplained in the residuals.</p>
<p>The sample F-statistic is compared to an F-distribution with <span class="math inline">\(df_{1} = 1\)</span> and <span class="math inline">\(df_{2} = n - 2\)</span> degrees of freedom.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<div class="optional-begin">
<span id="opt-start-105" class="fa fa-chevron-circle-right optional-icon clickable" onclick="toggle_visibility(&#39;opt-body-105&#39;, &#39;opt-start-105&#39;)"> Optional: Another formula for the F-test.</span>
</div>
<div id="opt-body-105" class="optional-body" style="display: none;">
<p>With some algebra we can also show that:
<span class="math display">\[
F = \frac{R^2 / 1}{(1 - R^2) / (n - 2) } = \frac{R^2 / df_{Model}}{(1 - R^2) / df_{Residual} }
\]</span></p>
<p>Proof:</p>
<p><span class="math display">\[
\begin{aligned}
F = \frac{SS_{Model} / 1}{SS_{Residual} / (n - 2)} 
= \frac{\frac{SS_{Model}}{SS_{Total}}}{\frac{SS_{Residual}}{SS_{Total}} \cdot \frac{1}{(n - 2)}} 
= \frac{R^2 / 1}{(1 - R^2) / (n - 2)}
\end{aligned}
\]</span></p>
</div>
<p class="optional-end">
</p>
</div>
<div class="question-begin">
Question A11
</div>
<div class="question-body">
<p>Look at the output of <code>summary()</code> of your model. Identify the relevant information to conduct an F-test against the null hypothesis that the model is ineffective at predicting income using education level.</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-106" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-106&#39;, &#39;sol-start-106&#39;)"> Solution </span>
</div>
<div id="sol-body-106" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = income ~ 1 + education, data = riverview)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -15.809  -5.783   2.088   5.127  18.379 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  11.3214     6.1232   1.849   0.0743 .  
## education     2.6513     0.3696   7.173 5.56e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 8.978 on 30 degrees of freedom
## Multiple R-squared:  0.6317, Adjusted R-squared:  0.6194 
## F-statistic: 51.45 on 1 and 30 DF,  p-value: 5.562e-08</code></pre>
<p>The relevant row is the following:</p>
<pre><code>F-statistic: 51.45 on 1 and 30 DF,  p-value: 5.562e-08</code></pre>
<p>We might interpret this as:</p>
<div class="int">
<p>We performed an F-test for the overall significance of the regression, <span class="math inline">\(F(1, 30) = 51.45, p &lt; .001\)</span>, indicating very strong evidence against the null hypothesis that the model is ineffective.</p>
<p>In other words, the data provide strong evidence that education is an effective predictor of income.</p>
</div>
</div>
<p class="solution-end">
</p>
<div class="optional-begin">
<span id="opt-start-107" class="fa fa-chevron-circle-right optional-icon clickable" onclick="toggle_visibility(&#39;opt-body-107&#39;, &#39;opt-start-107&#39;)"> Optional: Equivalence of t-test for the slope and model utility F-test in simple regression.</span>
</div>
<div id="opt-body-107" class="optional-body" style="display: none;">
<p><strong>In simple linear regression only</strong>, the F-statistic for overall model significance is equal to the square of the t-statistic for <span class="math inline">\(H_0: b_1 = 0\)</span>.</p>
<p>You can check that the squared t-statistic is equal, up to rounding error, to the F-statistic:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1)<span class="sc">$</span>fstatistic[<span class="st">&#39;value&#39;</span>]</span></code></pre></div>
<pre><code>##    value 
## 51.45152</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1)<span class="sc">$</span>coefficients[<span class="st">&#39;education&#39;</span>,<span class="st">&#39;t value&#39;</span>]</span></code></pre></div>
<pre><code>## [1] 7.172972</code></pre>
<p><span class="math display">\[
t^2 = F \\
7.173^2 = 51.452
\]</span></p>
<p>Here we will show the equivalence of the F-test for model effectiveness and t-test for the slope.</p>
<p>Recall the formula of the sum of squares due to the model. We will rewrite it in an equivalent form below:
<span class="math display">\[
\begin{aligned}
SS_{Model} &amp;= \sum_i (\hat y_i - \bar y)^2 \\
&amp;= \sum_i (\hat b_0 + \hat b_1 x_i - \bar y)^2 \\
&amp;= \sum_i (\bar y - \hat b_1 \bar x + \hat b_1 x_i - \bar y)^2 \\
&amp;= \sum_i (\hat b_1 (x_i - \bar x))^2 \\
&amp;= \hat b_1^2 \sum_i (x_i - \bar x)^2
\end{aligned}
\]</span></p>
<p>The F-statistic is given by:
<span class="math display">\[
\begin{aligned}
F = \frac{SS_{Model} / 1}{SS_{Residual} / (n - 2)} 
= \frac{\hat b_1^2 \sum_i (x_i - \bar x)^2}{\hat \sigma^2} 
= \frac{\hat b_1^2 }{\hat \sigma^2 / \sum_i (x_i - \bar x)^2}
\end{aligned}
\]</span></p>
<p>Now recall the formula of the t-statistic,
<span class="math display">\[
t = \frac{\hat b_1}{SE(\hat b_1)} = \frac{\hat b_1}{\hat \sigma / \sqrt{\sum_i (x_i - \bar x)^2}}
\]</span></p>
<p>It is evident that the latter is obtained as the square root of the former.</p>
</div>
<p class="optional-end">
</p>
</div>
<div id="binpred" class="section level2">
<h2>Binary predictors</h2>
<p>Let’s suppose that instead of having measured education in years, we had data instead on “Obtained College Degree: Yes/No.” Our explanatory variable would be binary categorical (think back to our discussion of <a href="01_categorical.html#Types_of_Data">types of data</a>).</p>
<p>Let us pretend that everyone with &gt;18 years of education has a college degree:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>riverview <span class="ot">&lt;-</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  riverview <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">degree =</span> <span class="fu">ifelse</span>(education <span class="sc">&gt;</span> <span class="dv">18</span>, <span class="st">&quot;Yes&quot;</span>, <span class="st">&quot;No&quot;</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<p>We may then plot our relationship as a boxplot. If you want to see the individual points, you could always “jitter” them (right-hand plot below)</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(riverview, <span class="fu">aes</span>(<span class="at">x =</span> degree, <span class="at">y =</span> income)) <span class="sc">+</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(riverview, <span class="fu">aes</span>(<span class="at">x =</span> degree, <span class="at">y =</span> income)) <span class="sc">+</span> </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">height=</span><span class="dv">0</span>, <span class="at">width=</span>.<span class="dv">05</span>)</span></code></pre></div>
<p><img src="07_regression_files/figure-html/unnamed-chunk-24-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="statbox">
<p><strong>Binary predictors in linear regression</strong></p>
<p>We can include categorical predictors in a linear regression, but the interpretation of the coefficients is very specific. Whereas we talked about coefficients being interpreted as “the change in <span class="math inline">\(y\)</span> associated with a 1-unit increase in <span class="math inline">\(x\)</span>,” for categorical explanatory variables, coefficients can be considered to examine differences in group means. However, they are actually doing exactly the same thing - the model is simply translating the levels (like “Yes”/“No”) in to 0s and 1s!</p>
<p>So while we may have in our dataframe a categorical predictor like the middle column “degree,” below, what is inputted into our model is more like the third column, “isYes.”</p>
<pre><code>## # A tibble: 32 × 3
##    income degree isYes
##     &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;
##  1   50.3 No         0
##  2   32.6 No         0
##  3   65.1 Yes        1
##  4   54.7 Yes        1
##  5   56.0 Yes        1
##  6   38.6 No         0
##  7   60.1 No         0
##  8   61.6 Yes        1
##  9   34.2 No         0
## 10   70.0 Yes        1
## # … with 22 more rows</code></pre>
<p>Our coefficients are just the same as before. The intercept is where our predictor equals zero, and the slope is the change in our outcome variable associated with a 1-unit change in our predictor.<br />
However, “zero” for this predictor variable now corresponds to a whole level. This is known as the “reference level.” Accordingly, the 1-unit change in our predictor (the move from “zero” to “one”) corresponds to the difference between the two levels.</p>
<p><img src="07_regression_files/figure-html/unnamed-chunk-26-1.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<p><img src="images/slr/catwalking.jpg" width="80%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="multiple-regression" class="section level1">
<h1>Multiple Regression</h1>
<p>In this next block of exercises, we move from the simple linear regression model (one outcome variable, one explanatory variable) to the <em>multiple regression model</em> (one outcome variable, multiple explanatory variables).<br />
Everything we just learned about simple linear regression can be extended (with minor modification) to the multiple regression model. The key conceptual difference is that for simple linear regression we think of the distribution of errors at some fixed value of the explanatory variable, and for multiple linear regression, we think about the distribution of errors at fixed set of values for all our explanatory variables.</p>
<div class="statbox">
<p><strong>Model formula</strong></p>
<p>For multiple linear regression, the model formula is an extension of the one predictor (“simple”) regression model, to include any number of predictors:<br />
<span class="math display">\[
y = b_0 \ + \ b_1 x_1 \ + \ b_2 x_2 \ + \ ... \ + b_k x_k \ + \ \epsilon \\ 
\quad \\ 
\text{where} \quad \epsilon \sim N(0, \sigma) \text{ independently}
\]</span></p>
<p>In the model specified above,</p>
<ul>
<li><span class="math inline">\(\mu_{y|x_1, x_2, ..., x_k} = b_0 + b_1 x + b_2 x_2 + ... b_k x_k\)</span> represents the systematic part of the model giving the mean of <span class="math inline">\(y\)</span> at each combination of values of variables <span class="math inline">\(x_1\)</span>-<span class="math inline">\(x_k\)</span>;</li>
<li><span class="math inline">\(\epsilon\)</span> represents the error (deviation) from that mean, and the errors are independent from one another.</li>
</ul>
<p><strong>Visual</strong></p>
<p>Note that for simple linear regression we talked about our model as a <em>line</em> in 2 dimensions: the systematic part <span class="math inline">\(b_0 + b_1 x\)</span> defined a line for <span class="math inline">\(\mu_y\)</span> across the possible values of <span class="math inline">\(x\)</span>, with <span class="math inline">\(\epsilon\)</span> as the random deviations from that line. But in multiple regression we have more than two variables making up our model.</p>
<p>In this particular case of three variables (one outcome + two explanatory), we can think of our model as a <em>regression surface</em> (See Figure <a href="#fig:regsurf">8</a>). The systematic part of our model defines the surface across a range of possible values of both <span class="math inline">\(x_1\)</span> <em>and</em> <span class="math inline">\(x_2\)</span>. Deviations from the surface are determined by the random error component, <span class="math inline">\(\hat \epsilon\)</span>.</p>
<div class="figure" style="text-align: center"><span id="fig:regsurf"></span>
<img src="07_regression_files/figure-html/regsurf-1.png" alt="Regression surface for wellbeing ~ outdoor_time + social_int, from two different angles" width="100%" />
<p class="caption">
Figure 8: Regression surface for wellbeing ~ outdoor_time + social_int, from two different angles
</p>
</div>
<p>Don’t worry about trying to figure out how to visualise it if we had any more explanatory variables! We can only concieve of 3 spatial dimensions. One could imagine this surface changing over time, which would bring in a 4th dimension, but beyond that, it’s not worth trying!.</p>
</div>
<!-- We previously used simple linear regression to examine whether score on the WMBWS was related to the amount of time spent outdoors (self-reported as the average number of hours per week). We will now extend this and build a multiple regression model which we can use to predict WEMWBS score based on both outdoor time *and* number of social interactions.   -->
<div class="question-begin">
Question B1
</div>
<div class="question-body">
<p>Let’s imagine that some reseachers are interested in the relationship between psychological wellbeing and time spent outdoors. They know that other aspects of peoples’ lifestyles such as how much social interaction they have can influence their mental well-being. They would like to study whether there is a relationship between well-being and time spent outdoors <em>after</em> taking into account the relationship between well-being and social interactions.</p>
<p>To evaluate this hypothesis, we are going to fit the following model:</p>
<p><span class="math display">\[
Wellbeing = b_0 \ + \ b_1 \cdot Outdoor Time \ + \ b_2 \cdot Social Interactions \ + \ \epsilon
\]</span></p>
<p>First, create a new section heading in your R script or RMarkdown document (whichever you are using) for the multiple regression exercises.<br />
Import the wellbeing data (detailed below) into R. We’ll give them the name <code>mwdata</code>.</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-108" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-108&#39;, &#39;sol-start-108&#39;)"> Solution </span>
</div>
<div id="sol-body-108" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in data</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>mwdata <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="st">&quot;https://uoepsy.github.io/data/wellbeing.csv&quot;</span>)</span></code></pre></div>
</div>
<p class="solution-end">
</p>
<div class="frame">
<p><strong>Data: Wellbeing</strong></p>
<p>The data is available at <a href="https://uoepsy.github.io/data/wellbeing.csv" class="uri">https://uoepsy.github.io/data/wellbeing.csv</a>.</p>
<p><strong>Description</strong></p>
<p>Researchers interviewed 32 participants, selected at random from the population of residents of Edinburgh &amp; Lothians. They used the Warwick-Edinburgh Mental Wellbeing Scale (WEMWBS), a self-report measure of mental health and well-being. The scale is scored by summing responses to each item, with items answered on a 1 to 5 Likert scale. The minimum scale score is 14 and the maximum is 70.<br />
The researchers also asked participants to estimate the average number of hours they spend outdoors each week, the average number of social interactions they have each week (whether on-line or in-person), and whether they believe that they stick to a routine throughout the week (Yes/No).</p>
<p>The data in <code>wellbeing.csv</code> contain five attributes collected from a random sample of <span class="math inline">\(n=32\)</span> hypothetical residents over Edinburgh &amp; Lothians, and include:</p>
<ul>
<li><code>wellbeing</code>: Warwick-Edinburgh Mental Wellbeing Scale (WEMWBS), a self-report measure of mental health and well-being. The scale is scored by summing responses to each item, with items answered on a 1 to 5 Likert scale. The minimum scale score is 14 and the maximum is 70.<br />
</li>
<li><code>outdoor_time</code>: Self report estimated number of hours per week spent outdoors<br />
</li>
<li><code>social_int</code>: Self report estimated number of social interactions per week (both online and in-person)</li>
<li><code>routine</code>: Binary Yes/No response to the question “Do you follow a daily routine throughout the week?”</li>
<li><code>location</code>: Location of primary residence (City, Suburb, Rural)</li>
</ul>
<p><strong>Preview</strong></p>
<p>The first six rows of the data are:</p>
<div id="sbgjustikv" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#sbgjustikv .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#sbgjustikv .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#sbgjustikv .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#sbgjustikv .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#sbgjustikv .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sbgjustikv .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#sbgjustikv .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#sbgjustikv .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#sbgjustikv .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#sbgjustikv .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#sbgjustikv .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#sbgjustikv .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#sbgjustikv .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#sbgjustikv .gt_from_md > :first-child {
  margin-top: 0;
}

#sbgjustikv .gt_from_md > :last-child {
  margin-bottom: 0;
}

#sbgjustikv .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#sbgjustikv .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#sbgjustikv .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#sbgjustikv .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#sbgjustikv .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#sbgjustikv .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#sbgjustikv .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#sbgjustikv .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sbgjustikv .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#sbgjustikv .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#sbgjustikv .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#sbgjustikv .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#sbgjustikv .gt_left {
  text-align: left;
}

#sbgjustikv .gt_center {
  text-align: center;
}

#sbgjustikv .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#sbgjustikv .gt_font_normal {
  font-weight: normal;
}

#sbgjustikv .gt_font_bold {
  font-weight: bold;
}

#sbgjustikv .gt_font_italic {
  font-style: italic;
}

#sbgjustikv .gt_super {
  font-size: 65%;
}

#sbgjustikv .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">wellbeing</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">outdoor_time</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">social_int</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">location</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">routine</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_right">30</td>
<td class="gt_row gt_right">7</td>
<td class="gt_row gt_right">8</td>
<td class="gt_row gt_left">Suburb</td>
<td class="gt_row gt_left">Routine</td></tr>
    <tr><td class="gt_row gt_right">21</td>
<td class="gt_row gt_right">9</td>
<td class="gt_row gt_right">8</td>
<td class="gt_row gt_left">City</td>
<td class="gt_row gt_left">No Routine</td></tr>
    <tr><td class="gt_row gt_right">38</td>
<td class="gt_row gt_right">14</td>
<td class="gt_row gt_right">10</td>
<td class="gt_row gt_left">Suburb</td>
<td class="gt_row gt_left">Routine</td></tr>
    <tr><td class="gt_row gt_right">27</td>
<td class="gt_row gt_right">16</td>
<td class="gt_row gt_right">10</td>
<td class="gt_row gt_left">City</td>
<td class="gt_row gt_left">No Routine</td></tr>
    <tr><td class="gt_row gt_right">20</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_right">10</td>
<td class="gt_row gt_left">Rural</td>
<td class="gt_row gt_left">No Routine</td></tr>
    <tr><td class="gt_row gt_right">37</td>
<td class="gt_row gt_right">11</td>
<td class="gt_row gt_right">12</td>
<td class="gt_row gt_left">Suburb</td>
<td class="gt_row gt_left">No Routine</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<div class="question-begin">
Question B2
</div>
<div class="question-body">
<p>Explore and describe the relevant variables and relationships.</p>
<div class="optional-begin">
<span id="opt-start-109" class="fa fa-chevron-circle-right optional-icon clickable" onclick="toggle_visibility(&#39;opt-body-109&#39;, &#39;opt-start-109&#39;)"> Hints</span>
</div>
<div id="opt-body-109" class="optional-body" style="display: none;">
<ul>
<li>Produce plots of the <em>marginal distributions</em> (the distributions of each variable in the analysis without reference to the other variables) of the <code>wellbeing</code>, <code>outdoor_time</code>, and <code>social_int</code> variables.</li>
<li>Produce plots of the <em>marginal relationships</em> between the outcome variable (<code>wellbeing</code>) and each of the explanatory variables.<br />
</li>
<li>Produce a correlation matrix of the variables which are to be used in the analysis, and write a short paragraph describing the relationships.</li>
</ul>
<div class="statbox">
<p><strong>Correlation matrix</strong></p>
<p>A table showing the correlation coefficients - <span class="math inline">\(r_{(x,y)}=\frac{\mathrm{cov}(x,y)}{s_xs_y}\)</span> - between variables. Each cell in the table shows the relationship between two variables. The diagonals show the correlation of a variable with itself (and are therefore always equal to 1).</p>
</div>
<div class="rtip">
<p>We can create a correlation matrix easily by giving the <code>cor()</code> function a dataframe. However, we only want to give it 3 columns here. Think about how we select specific columns, either using <code>select()</code>, or giving the column numbers inside <code>[]</code>.</p>
</div>
</div>
<p class="optional-end">
</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-110" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-110&#39;, &#39;sol-start-110&#39;)"> Solution </span>
</div>
<div id="sol-body-110" class="solution-body" style="display: none;">
<p>We should be familiar now with how to visualise a marginal distribution. You might choose histograms, density curves, or boxplots, or a combination:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork) <span class="co">#used to arrange plots</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>wellbeing_plot <span class="ot">&lt;-</span> </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> mwdata, <span class="fu">aes</span>(<span class="at">x =</span> wellbeing)) <span class="sc">+</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>() <span class="sc">+</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">250</span>) <span class="sc">+</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Score on WEMWBS (range 14-70)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Probability</span><span class="sc">\n</span><span class="st">density&quot;</span>)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>outdoortime_plot <span class="ot">&lt;-</span> </span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> mwdata, <span class="fu">aes</span>(<span class="at">x =</span> outdoor_time)) <span class="sc">+</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>() <span class="sc">+</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">200</span>) <span class="sc">+</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Time spent outdoors per week (hours)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Probability</span><span class="sc">\n</span><span class="st">density&quot;</span>)</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>social_plot <span class="ot">&lt;-</span> </span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> mwdata, <span class="fu">aes</span>(<span class="at">x =</span> social_int)) <span class="sc">+</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>() <span class="sc">+</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">150</span>) <span class="sc">+</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Number of social interactions per week&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Probability</span><span class="sc">\n</span><span class="st">density&quot;</span>)</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a><span class="co"># the &quot;patchwork&quot; library allows us to arrange multiple plots</span></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>wellbeing_plot <span class="sc">/</span> outdoortime_plot <span class="sc">/</span> social_plot</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-30"></span>
<img src="07_regression_files/figure-html/unnamed-chunk-30-1.png" alt="Marginal distribution plots of wellbeing sores, weekly hours spent outdoors, and social interactions" width="80%" />
<p class="caption">
Figure 9: Marginal distribution plots of wellbeing sores, weekly hours spent outdoors, and social interactions
</p>
</div>
<div class="int">
<ul>
<li>The marginal distribution of scores on the WEMWBS is unimodal with a mean of approximately 43. There is variation in scores (SD = 11.7).<br />
</li>
<li>The marginal distribution of weekly hours spend outdoors is unimodal with a mean of approximately 14.8 hours. There is variation in outdoor time (SD = 6.9 hours).<br />
</li>
<li>The marginal distribution of numbers of social interactions per week is unimodal with a mean of approximately 16. There is variation in in numbers of social interactions per week (SD = 4.4).</li>
</ul>
</div>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>wellbeing_outdoor <span class="ot">&lt;-</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> mwdata, <span class="fu">aes</span>(<span class="at">x =</span> outdoor_time, <span class="at">y =</span> wellbeing)) <span class="sc">+</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Time spent outdoors per week (hours)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Wellbeing score (WEMWBS)&quot;</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>wellbeing_social <span class="ot">&lt;-</span> </span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> mwdata, <span class="fu">aes</span>(<span class="at">x =</span> social_int, <span class="at">y =</span> wellbeing)) <span class="sc">+</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Number of social interactions per week&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Wellbeing score (WEMWBS)&quot;</span>)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>wellbeing_outdoor <span class="sc">|</span> wellbeing_social</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:mwdata-mlr-rels"></span>
<img src="07_regression_files/figure-html/mwdata-mlr-rels-1.png" alt="Scatterplots displaying the relationships between scores on the WEMWBS and a) weekly outdoor time (hours), and b) weekly number of social interactions" width="80%" />
<p class="caption">
Figure 10: Scatterplots displaying the relationships between scores on the WEMWBS and a) weekly outdoor time (hours), and b) weekly number of social interactions
</p>
</div>
<p>We can either use:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># correlation matrix of the first 3 columns</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(mwdata[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])</span></code></pre></div>
<p>or:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select only the columns we want by name, and pass this to cor()</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>mwdata <span class="sc">%&gt;%</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(wellbeing, outdoor_time, social_int) <span class="sc">%&gt;%</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>()</span></code></pre></div>
<pre><code>##              wellbeing outdoor_time social_int
## wellbeing    1.0000000    0.5815613  0.7939003
## outdoor_time 0.5815613    1.0000000  0.3394469
## social_int   0.7939003    0.3394469  1.0000000</code></pre>
<div class="int">
<p>There is a moderate, positive, linear relationship between weekly outdoor time and WEMWBS scores for the participants in the sample.
Participants’ wellbeing scores tend to increase, on average, with the number of hours spent outdoors each week.<br />
There is a moderate, positive, linear relationship between the weekly number of social interactions and WEMWBS scores for the participants in the sample.
Participants’ wellbeing scores tend to increase, on average, with the weekly number of social interactions.
There is also a weak positive correlation between weekly outdoor time and the weekly number of social interactions.</p>
</div>
<p><br>
Note that there is a weak correlation between our two explanatory variables (outdoor_time and social_int). We will return to how this might affect our model when later on we look at the assumptions of multiple regression.</p>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question B3
</div>
<div class="question-body">
<p>In R, using <code>lm()</code>, fit the linear model specified by the formula below, assigning the output to a name to store it in your environment.</p>
<p><span class="math display">\[
Wellbeing = b_0 \ + \ b_1 \cdot Outdoor Time \ + \ b_2 \cdot Social Interactions \ + \ \epsilon
\]</span></p>
<p><em>Tip:</em>
As we did for simple linear regression, we can fit our multiple regression model using the <code>lm()</code> function. We can add as many explanatory variables as we like, separating them with a <code>+</code>.</p>
<pre><code>[model name] &lt;- lm([response variable] ~ 1 + [explanatory variable 1] + [explanatory variable 2] + ... , data = [dataframe])</code></pre>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-111" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-111&#39;, &#39;sol-start-111&#39;)"> Solution </span>
</div>
<div id="sol-body-111" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>wbmodel <span class="ot">&lt;-</span> <span class="fu">lm</span>(wellbeing <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> outdoor_time <span class="sc">+</span> social_int, <span class="at">data =</span> mwdata)</span></code></pre></div>
</div>
<p class="solution-end">
</p>
<div class="statbox">
<p><strong>Interpretation of Muliple Regression Coefficients</strong></p>
<p>The parameters of a multiple regression model are:</p>
<ul>
<li><span class="math inline">\(b_0\)</span> (The intercept);</li>
<li><span class="math inline">\(b_1\)</span> (The slope across values of <span class="math inline">\(x_1\)</span>);</li>
<li>…<br />
</li>
<li>…</li>
<li><span class="math inline">\(b_k\)</span> (The slope across values of <span class="math inline">\(x_k\)</span>);</li>
<li><span class="math inline">\(\sigma\)</span> (The standard deviation of the errors).</li>
</ul>
<p><br>
You’ll hear a lot of different ways that people explain multiple regression coefficients.<br />
For the model <span class="math inline">\(y = b_0 + b_1 x_1 + b_2 x_2 + \epsilon\)</span>, the estimate <span class="math inline">\(\hat b_1\)</span> will often be reported as:</p>
<p>the increase in <span class="math inline">\(y\)</span> for a one unit increase in <span class="math inline">\(x_1\)</span> when…</p>
<ul>
<li>holding the effect of <span class="math inline">\(x_2\)</span> constant.</li>
<li>controlling for differences in <span class="math inline">\(x_2\)</span>.</li>
<li>partialling out the effects of <span class="math inline">\(x_2\)</span>.</li>
<li>holding <span class="math inline">\(x_2\)</span> equal.</li>
<li>accounting for effects of <span class="math inline">\(x_2\)</span>.</li>
</ul>
<div class="int">
<pre><code>##               Estimate Std. Error  t value     Pr(&gt;|t|)
## (Intercept)  5.3703775  4.3205141 1.242995 2.238259e-01
## outdoor_time 0.5923673  0.1689445 3.506284 1.499467e-03
## social_int   1.8034489  0.2690982 6.701825 2.369845e-07</code></pre>
<p>The coefficient 0.59 of weekly outdoor time for predicting wellbeing score says that among those with the same number of social interactions per week, those who have one additional hour of outdoor time tend to, on average, score 0.59 higher on the WEMWBS wellbeing scale. The multiple regression coefficient measures that average <em>conditional</em> relationship.</p>
</div>
</div>
<!-- :::statbox -->
<!-- Just like the simple linear regression, when we estimate parameters from the available data, we have: -->
<!-- - A _fitted model_ (recall that the h$\hat{\textrm{a}}$ts are used to distinguish our _estimates_ from the _true unknown parameters_):  -->
<!-- $$ -->
<!-- \widehat{Wellbeing} = \hat \beta_0 + \hat \beta_1 \cdot Outdoor Time + \hat \beta_2 \cdot Social Interactions -->
<!-- $$ -->
<!-- - And we have the residuals $\hat \epsilon = y - \hat y$ which are the deviations from the observed values and our model-predicted responses.   -->
<!-- ::: -->
<div class="question-begin">
Question B4
</div>
<div class="question-body">
<ul>
<li>Extract <em>and interpret</em> the parameter estimates (the “coefficients”) from your model (<code>summary()</code>, <code>coef()</code>, <code>$coefficients</code> etc will be useful here).<br />
</li>
<li>Within what distance from the model predicted values (the regression surface) would we expect 95% of WEMWBS wellbeing scores to be? (Either <code>sigma()</code> or part of the output from <code>summary()</code> will help you for this)</li>
</ul>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-112" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-112&#39;, &#39;sol-start-112&#39;)"> Solution </span>
</div>
<div id="sol-body-112" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(wbmodel)</span></code></pre></div>
<pre><code>##  (Intercept) outdoor_time   social_int 
##    5.3703775    0.5923673    1.8034489</code></pre>
<ul>
<li><span class="math inline">\(\hat \beta_0\)</span> = 5.37, the estimated average wellbeing score associated with zero hours of outdoor time and zero social interactions per week.<br />
</li>
<li><span class="math inline">\(\hat \beta_1\)</span> = 0.59, the estimated increase in average wellbeing score associated with one hour increase in weekly outdoor time, <em>holding the number of social interactions constant</em> (i.e., when the remaining explanatory variables are held at the same value or are fixed).</li>
<li><span class="math inline">\(\hat \beta_2\)</span> = 1.8, the estimated increase in average wellbeing score associated with an additional social interaction per week (an increase of one), <em>holding weekly outdoor time constant</em>.</li>
</ul>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sigma</span>(wbmodel)</span></code></pre></div>
<pre><code>## [1] 6.148276</code></pre>
<p>The estimated standard deviation of the errors is <span class="math inline">\(\hat \sigma\)</span> = 6.15. We would expect 95% of wellbeing scores to be within about 12.3 (<span class="math inline">\(2 \hat \sigma\)</span>) from the model fit.</p>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question B5
</div>
<div class="question-body">
<p>We can obtain confidence intervals for our estimates. These provide a means of quantifying the uncertainty (or precision) of our estimates.</p>
<div class="statbox">
<p>Think of a confidence interval like a ring-toss.<br />
The population parameter is some value, but we only have a sample, with which we use to <em>estimate</em> the value in the population.
95% Confidence Intervals are a way of saying “95% of the times I might throw this ring, it will land on the stake.”
(see <span class="citation">(<a href="#ref-EpiEllie" role="doc-biblioref"><strong>EpiEllie?</strong></a>)</span> <a href="https://twitter.com/epiellie/status/1073385427317465089" class="uri">https://twitter.com/epiellie/status/1073385427317465089</a> )</p>
</div>
<p>Look up the function <code>confint()</code> and obtain some 95% Confidence Intervals for the coefficients.</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-113" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-113&#39;, &#39;sol-start-113&#39;)"> Solution </span>
</div>
<div id="sol-body-113" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(wbmodel, <span class="at">level =</span> <span class="fl">0.95</span>)</span></code></pre></div>
<pre><code>##                   2.5 %     97.5 %
## (Intercept)  -3.4660660 14.2068209
## outdoor_time  0.2468371  0.9378975
## social_int    1.2530813  2.3538164</code></pre>
<div class="int">
<ul>
<li>The average wellbeing score for all those with zero hours of outdoor time and zero social interactions per week is between -3.47 and 14.21.<br />
</li>
<li>When <em>holding the number of social interactions per week constant</em>, each one hour increase in weekly outdoor time is associated with a difference in wellbeing scores between 0.25 and 0.94, on average.<br />
</li>
<li>When <em>holding weekly outdoor time constant</em>, each increase of one social interaction per week is associated with a difference in wellbeing scores between 1.25 and 2.35, on average.</li>
</ul>
</div>
</div>
<p class="solution-end">
</p>
<div id="more-model-evaluation" class="section level2">
<h2>More Model Evaluation</h2>
<div class="statbox">
<p><strong>Adjusted <span class="math inline">\(R^2\)</span></strong></p>
<p>We know from our work on simple linear regression that the R-squared can be obtained as:
<span class="math display">\[
R^2 = \frac{SS_{Model}}{SS_{Total}} = 1 - \frac{SS_{Residual}}{SS_{Total}}
\]</span></p>
<p>However, when we add more and more predictors into a multiple regression model, <span class="math inline">\(SS_{Residual}\)</span> cannot increase, and may decrease by pure chance alone, even if the predictors are unrelated to the outcome variable. Because <span class="math inline">\(SS_{Total}\)</span> is constant, the calculation <span class="math inline">\(1-\frac{SS_{Residual}}{SS_{Total}}\)</span> will increase by chance alone.</p>
<p>An alternative, the Adjusted-<span class="math inline">\(R^2\)</span>, does not necessarily increase with the addition of more explanatory variables, by including a penalty according to the number of explanatory variables in the model. It is not by itself meaningful, but can be useful in determining what predictors to include in a model.
<span class="math display">\[
Adjusted{-}R^2=1-\frac{(1-R^2)(n-1)}{n-k-1} \\
\quad \\
\begin{align}
&amp; \text{Where:} \\
&amp; n = \text{sample size} \\
&amp; k = \text{number of explanatory variables} \\
\end{align}
\]</span></p>
<hr />
<p><strong>In R,</strong> you can view the mutiple and adjusted <span class="math inline">\(R^2\)</span> at the bottom of the output of <code>summary(&lt;modelname&gt;)</code>:</p>
<div class="figure" style="text-align: left"><span id="fig:mlroutputrsq"></span>
<img src="images/mlr/mlroutputrsq.png" alt="Multiple regression output in R, summary.lm(). R-squared highlighted" width="80%" />
<p class="caption">
Figure 11: Multiple regression output in R, summary.lm(). R-squared highlighted
</p>
</div>
</div>
<div class="statbox">
<p><strong>F-ratio</strong></p>
<p>As in simple linear regression, the F-ratio is used to test the null hypothesis that <strong>all</strong> regression slopes are zero (it is just that now that we have multiple predictors, “all” is more than 1).</p>
<p>It is called the F-ratio because it is the ratio of the how much of the variation is explained by the model (per parameter) versus how much of the variation is unexplained (per remaining degrees of freedom).</p>
<p><span class="math display">\[
F_{df_{model},df_{residual}} = \frac{MS_{Model}}{MS_{Residual}} = \frac{SS_{Model}/df_{Model}}{SS_{Residual}/df_{Residual}} \\
\quad \\
\begin{align}
&amp; \text{Where:} \\
&amp; df_{model} = k \\
&amp; df_{error} = n-k-1 \\
&amp; n = \text{sample size} \\
&amp; k  = \text{number of explanatory variables} \\
\end{align}
\]</span></p>
<hr />
<p><strong>In R,</strong> at the bottom of the output of <code>summary(&lt;modelname&gt;)</code>, you can view the F ratio, along with an hypothesis test against the alternative hypothesis that the at least one of the coefficients <span class="math inline">\(\neq 0\)</span> (under the null hypothesis that all coefficients = 0, the ratio of explained:unexplained variance should be approximately 1):</p>
<div class="figure" style="text-align: left"><span id="fig:mlroutputrf"></span>
<img src="images/mlr/mlroutputf.png" alt="Multiple regression output in R, summary.lm(). F statistic highlighted" width="80%" />
<p class="caption">
Figure 12: Multiple regression output in R, summary.lm(). F statistic highlighted
</p>
</div>
</div>
<div class="question-begin">
Question C1
</div>
<div class="question-body">
<p><span class="math display">\[
Wellbeing = \beta_0 \ + \ \beta_1 \cdot Outdoor Time \ + \ \beta_2 \cdot Social Interactions \ + \ \epsilon
\]</span></p>
<p>Does our model (above) provide a better fit to the data than a model with no explanatory variables? (i.e., test against the alternative hypothesis that at least one of the explanatory variables significantly predicts wellbeing scores).</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-114" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-114&#39;, &#39;sol-start-114&#39;)"> Solution </span>
</div>
<div id="sol-body-114" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wbmodel)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = wellbeing ~ 1 + outdoor_time + social_int, data = mwdata)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -9.742 -4.915 -1.255  5.628 10.936 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    5.3704     4.3205   1.243   0.2238    
## outdoor_time   0.5924     0.1689   3.506   0.0015 ** 
## social_int     1.8034     0.2691   6.702 2.37e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 6.148 on 29 degrees of freedom
## Multiple R-squared:  0.7404, Adjusted R-squared:  0.7224 
## F-statistic: 41.34 on 2 and 29 DF,  p-value: 3.226e-09</code></pre>
<div class="int">
<p>Weekly social interactions and outdoor time explained 72.2% of the variance (adjusted <span class="math inline">\(R^2\)</span> =0.722, <span class="math inline">\(F\)</span>(2,29)=41.3, p&lt;.001)</p>
</div>
</div>
<p class="solution-end">
</p>
</div>
</div>
<div id="model-comparison" class="section level1">
<h1>Model Comparison</h1>
<div id="incremental-f-test" class="section level3 statbox">
<h3>Incremental F-test</h3>
<p>The F-ratio we see at the bottom of <code>summary(model)</code> is actually a comparison between two models: our model (with some explanatory variables in predicting <span class="math inline">\(y\)</span>) and <strong>the null model.</strong> In regression, the null model can be thought of as the model in which all explanatory variables have zero regression coefficients. It is also referred to as the <strong>intercept-only model</strong>, because if all predictor variable coefficients are zero, then the only we are only estimating <span class="math inline">\(y\)</span> via an intercept (which will be the mean: <span class="math inline">\(\bar y\)</span>).</p>
<p>But we don’t always have to comare our model to the null model. We can compare it to all the intermediate models which vary in the complexity, from the null model to our full model.</p>
<div class="imp">
<p>If (<em>and only if</em>) two models are <strong>nested</strong> (one model contains all the predictors of the other and is fitted to the same data), we can compare them using an <strong>incremental F-test.</strong></p>
</div>
<p>This is a formal test of whether the additional predictors provide a better fitting model.<br />
Formally this is the test of:</p>
<ul>
<li><span class="math inline">\(H_0:\)</span> coefficients for the added/ommitted variables are all zero.</li>
<li><span class="math inline">\(H_1:\)</span> at least one of the added/ommitted variables has a coefficient that is not zero.</li>
</ul>
<div class="rtip">
<p><strong>In R,</strong> we can conduct an incremental F-test by constructing two models, and passing them to the <code>anova()</code> function: <code>anova(model1, model2)</code>.</p>
</div>
<div class="optional-begin">
<span id="opt-start-115" class="fa fa-chevron-circle-right optional-icon clickable" onclick="toggle_visibility(&#39;opt-body-115&#39;, &#39;opt-start-115&#39;)"> Optional: F-ratio written for model comparison</span>
</div>
<div id="opt-body-115" class="optional-body" style="display: none;">
<p>The F-ratio for comparing the residual sums of squares between two models can be written as:</p>
<p><span class="math display">\[
F_{(df_R-df_F),df_F} = \frac{(SSR_R-SSR_F)/(df_R-df_F)}{SSR_F / df_F} \\
\quad \\
\begin{align}
&amp; \text{Where:} \\
&amp; SSR_R = \text{residual sums of squares for the restricted model} \\
&amp; SSR_F = \text{residual sums of squares for the full model} \\
&amp; df_R = \text{residual degrees of freedom from the restricted model} \\
&amp; df_F = \text{residual degrees of freedom from the full model} \\
\end{align}
\]</span></p>
</div>
<p class="optional-end">
</p>
</div>
<div class="question-begin">
Question C2
</div>
<div class="question-body">
<p>Use the code below to fit the null model.<br />
Then, use the <code>anova()</code> function to perform a model comparison between our earlier model and the null model.<br />
Check that the F statistic is the same as that which is given at the bottom of the <code>summary()</code> output of our model.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>null_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(wellbeing <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> mwdata)</span></code></pre></div>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-116" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-116&#39;, &#39;sol-start-116&#39;)"> Solution </span>
</div>
<div id="sol-body-116" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the null model</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>null_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(wellbeing <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> mwdata)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="co"># model comparison null vs wb_mdl1</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(null_model, wbmodel)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: wellbeing ~ 1
## Model 2: wellbeing ~ 1 + outdoor_time + social_int
##   Res.Df    RSS Df Sum of Sq      F    Pr(&gt;F)    
## 1     31 4222.0                                  
## 2     29 1096.2  2    3125.8 41.345 3.226e-09 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract f statistic from summary of wb_mdl1</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wbmodel)<span class="sc">$</span>fstatistic</span></code></pre></div>
<pre><code>##    value    numdf    dendf 
## 41.34465  2.00000 29.00000</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we can retrieve the p-value:</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>fstat <span class="ot">=</span> <span class="fu">summary</span>(wbmodel)<span class="sc">$</span>fstatistic[<span class="dv">1</span>]</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>df_1 <span class="ot">=</span> <span class="fu">summary</span>(wbmodel)<span class="sc">$</span>fstatistic[<span class="dv">2</span>]</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>df_2 <span class="ot">=</span> <span class="fu">summary</span>(wbmodel)<span class="sc">$</span>fstatistic[<span class="dv">3</span>]</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="fu">pf</span>(fstat, df_1, df_2, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>##        value 
## 3.225549e-09</code></pre>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question C3
</div>
<div class="question-body">
<p>We can also see quickly all the F-ratios at the addition of each explanatory variable incrementally, by just using <code>anova(model)</code>.</p>
<p>Fit these models:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>null_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(wellbeing <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> mwdata)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wellbeing <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> outdoor_time, <span class="at">data =</span> mwdata)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wellbeing <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> outdoor_time <span class="sc">+</span> social_int, <span class="at">data =</span> mwdata)</span></code></pre></div>
<p>And compare the different outputs from each of these lines of code:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(null_model, model1, model2)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model2)</span></code></pre></div>
<p><strong>Using either of the outputs from the above two lines of code, does weekly outdoor time explain a significant amount of variance in wellbeing scores over and above weekly social interactions?</strong></p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-117" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-117&#39;, &#39;sol-start-117&#39;)"> Solution </span>
</div>
<div id="sol-body-117" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>null_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(wellbeing <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> mwdata)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wellbeing <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> outdoor_time, <span class="at">data =</span> mwdata)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wellbeing <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> outdoor_time <span class="sc">+</span> social_int, <span class="at">data =</span> mwdata)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1)<span class="sc">$</span>adj.r.sq</span></code></pre></div>
<pre><code>## [1] 0.316154</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2)<span class="sc">$</span>adj.r.sq</span></code></pre></div>
<pre><code>## [1] 0.7224443</code></pre>
<div class="int">
<p>The model <em>with</em> weekly outdoor time as a predictor explains 0.7% of the variance, and the model <em>without</em> explains 0.3%.</p>
</div>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model1, model2)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: wellbeing ~ 1 + outdoor_time
## Model 2: wellbeing ~ 1 + outdoor_time + social_int
##   Res.Df    RSS Df Sum of Sq      F   Pr(&gt;F)    
## 1     30 2794.1                                 
## 2     29 1096.2  1    1697.8 44.914 2.37e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="int">
<p>Numbers of social interactions was found to explain a significant amount of variance in wellbeing scores over and above weekly outdoor time<br />
<span class="math inline">\(F\)</span>(1 )=NA, 44.91, p&lt;.001.</p>
</div>
</div>
<p class="solution-end">
</p>
<div class="question-begin">
Question C4
</div>
<div class="question-body">
<p>Play around with changing the <em>order</em> of the explanatory variables in our model. This will <strong>not</strong> change the <code>summary()</code> output, but it <strong>will</strong> change the <code>anova(model)</code> output.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wellbeing <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> outdoor_time <span class="sc">+</span> social_int, <span class="at">data =</span> mwdata)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>model2a <span class="ot">&lt;-</span> <span class="fu">lm</span>(wellbeing <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> social_int <span class="sc">+</span> outdoor_time, <span class="at">data =</span> mwdata)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2a)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model2)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model2a)</span></code></pre></div>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-118" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-118&#39;, &#39;sol-start-118&#39;)"> Solution </span>
</div>
<div id="sol-body-118" class="solution-body" style="display: none;">
<p>The <code>summary()</code> output for these two models will be the same numbers, but just in a different order.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wellbeing <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> outdoor_time <span class="sc">+</span> social_int, <span class="at">data =</span> mwdata)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>model2a <span class="ot">&lt;-</span> <span class="fu">lm</span>(wellbeing <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> social_int <span class="sc">+</span> outdoor_time, <span class="at">data =</span> mwdata)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2)<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code>##               Estimate Std. Error  t value     Pr(&gt;|t|)
## (Intercept)  5.3703775  4.3205141 1.242995 2.238259e-01
## outdoor_time 0.5923673  0.1689445 3.506284 1.499467e-03
## social_int   1.8034489  0.2690982 6.701825 2.369845e-07</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2a)<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code>##               Estimate Std. Error  t value     Pr(&gt;|t|)
## (Intercept)  5.3703775  4.3205141 1.242995 2.238259e-01
## social_int   1.8034489  0.2690982 6.701825 2.369845e-07
## outdoor_time 0.5923673  0.1689445 3.506284 1.499467e-03</code></pre>
<p>The <code>anova()</code> output will be <em>different</em> for these two models, because it tests the <strong>incremental</strong> addition of each explanatory variable in the order in which they are inputted into the model.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model2)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: wellbeing
##              Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## outdoor_time  1 1427.9  1427.9  37.775 1.068e-06 ***
## social_int    1 1697.8  1697.8  44.914 2.370e-07 ***
## Residuals    29 1096.2    37.8                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model2a)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: wellbeing
##              Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
## social_int    1 2661.03 2661.03  70.395 3.015e-09 ***
## outdoor_time  1  464.73  464.73  12.294  0.001499 ** 
## Residuals    29 1096.24   37.80                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
<p class="solution-end">
</p>
<div class="lo">
<p>We should be careful when we conduct research and take the time to think about <em>what</em> exactly we are measuring, and <em>how.</em></p>
<p>The notion of performing the “incremental tests” that we have just seen provides a good example of when we can fall foul of “measurement error.”<br />
If you’re interested, we have written up a fun little example on incremental validity, which you can <a href="https://uoepsy.github.io/usmr/labs/zz_incrementalvalidity.html">find here.</a></p>
</div>
<div class="question-begin">
Question C5
</div>
<div class="question-body">
<p>Does the addition of routine provide significant improvement to model fit, after accounting for the effects of outdoor time and social interactions?</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-119" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-119&#39;, &#39;sol-start-119&#39;)"> Solution </span>
</div>
<div id="sol-body-119" class="solution-body" style="display: none;">
<p>We can do this with one:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>model3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wellbeing <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> outdoor_time <span class="sc">+</span> social_int <span class="sc">+</span> routine, <span class="at">data =</span> mwdata)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model3)</span></code></pre></div>
<p>Or the same thing with two models:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wellbeing <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> outdoor_time <span class="sc">+</span> social_int, <span class="at">data =</span> mwdata)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>model3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wellbeing <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> outdoor_time <span class="sc">+</span> social_int <span class="sc">+</span> routine, <span class="at">data =</span> mwdata)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model2, model3)</span></code></pre></div>
</div>
<p class="solution-end">
</p>
</div>
<div id="making" class="section level1">
<h1>Making Valid Inferences</h1>
<div class="lo">
<p>So far, we have been fitting and interpreting our regression models. In each case, we first specified the model, then visually explored the marginal distributions and relationships of variables which would be used in the analysis. Then, once we fitted the model, we began to examine the fit by studying what the various parameter estimates represented, and the spread of the residuals. We saw these in the output of <code>summary()</code> of a model - they were shown in the parts of the output inside the red boxes in Figure <a href="#fig:mlroutput">13</a>).</p>
<div class="figure" style="text-align: center"><span id="fig:mlroutput"></span>
<img src="images/mlr/mlroutput.png" alt="Multiple regression output in R, summary.lm(). Residuals and Coefficients highlighted" width="80%" />
<p class="caption">
Figure 13: Multiple regression output in R, summary.lm(). Residuals and Coefficients highlighted
</p>
</div>
We also discussed drawing inferences using our model estimates, as well as using a model to make predictions.
However, we should really not have done this prior to being satisfied that our model meets a certain set of assumptions. All of the estimates, intervals and hypothesis tests (see Figure <a href="#fig:mlroutputhyp">14</a>) resulting from a regression analysis <em>assume</em> a certain set of conditions have been met. Meeting these conditions is what allows us to generalise our findings beyond our sample (i.e., to the population).<br />

<div class="figure" style="text-align: center"><span id="fig:mlroutputhyp"></span>
<img src="images/mlr/mlrhyp.png" alt="Multiple regression output in R, summary.lm(). Hypothesis tests highlighted" width="80%" />
<p class="caption">
Figure 14: Multiple regression output in R, summary.lm(). Hypothesis tests highlighted
</p>
</div>
</div>
<div id="assumptions" class="section level2">
<h2>Assumptions</h2>
<div class="statbox">
<p><strong>Assumptions: The broad idea</strong></p>
<p>All our work here is in aim of making <strong>models of the world</strong>.</p>
<ul>
<li>Models are models. They are simplifications. They are therefore wrong.<br />
</li>
<li>Our residuals ( <span class="math inline">\(y - \hat{y}\)</span> ) reflect everything that we <strong>don’t</strong> account for in our model.<br />
</li>
<li>In an ideal world, our model accounts for <em>all</em> the systematic relationships. The leftovers (our residuals) are just random noise.<br />
</li>
<li>If our model is mis-specified, or we don’t measure some systematic relationship, then our residuals will reflect this.<br />
We check by examining how much “like randomness” the residuals appear to be (zero mean, normally distributed, constant variance, i.i.d (“independent and identically distributed”). These ideas tend to get referred to as our <strong>“assumptions.”</strong><br />
</li>
<li>While we will <strong>never</strong> know whether our residuals contain only randomness (we can never observe everything), our ability to generalise from the model we fit on sample data to the wider population relies on these assumptions.</li>
</ul>
<hr />
<p><strong>Assumptions in a nutshell</strong></p>
<p>In using linear regression, we have assumptions about our model in that we assume that modelling the outcome variable as a <strong>linear</strong> combination of the explanatory variables is an appropriate thing to do.<br />
We also make certain assumptions about what we have <em>left out</em> of our model - the <strong>errors</strong> component.<br />
<!-- $$ -->
<!-- \color{red}{y} = \color{blue}{\underbrace{\beta_0 \cdot{} 1 + \beta_1 \cdot{} x_1 + ... + \beta_k \cdot x_k}_{X \boldsymbol \beta}} + \varepsilon -->
<!-- $$ --></p>
<p>Specifically, we assume that our errors have <strong>“zero mean and constant variance”</strong>.</p>
<ul>
<li>mean of the residuals = zero across the predicted values on the linear predictor.<br />
</li>
<li>spread of residuals is normally distributed and constant across the predicted values on the linear predictor.</li>
</ul>
<div class="optional-begin">
<span id="opt-start-120" class="fa fa-chevron-circle-right optional-icon clickable" onclick="toggle_visibility(&#39;opt-body-120&#39;, &#39;opt-start-120&#39;)"> What does it look like?</span>
</div>
<div id="opt-body-120" class="optional-body" style="display: none;">
<p><img src="07_regression_files/figure-html/unnamed-chunk-52-1.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<p class="optional-end">
</p>
<div class="optional-begin">
<span id="opt-start-121" class="fa fa-chevron-circle-right optional-icon clickable" onclick="toggle_visibility(&#39;opt-body-121&#39;, &#39;opt-start-121&#39;)"> What does it <b>not</b> look like?</span>
</div>
<div id="opt-body-121" class="optional-body" style="display: none;">
<p>Things look a bit wrong (like there is something systematic that we haven’t accounted for), when our residuals do not have mean zero:<br />
<img src="07_regression_files/figure-html/unnamed-chunk-53-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Or do not have constant variance:
<img src="07_regression_files/figure-html/unnamed-chunk-54-1.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<p class="optional-end">
</p>
</div>
<div class="rtip">
<p><strong>Assumptions in R</strong></p>
<p>We can get a lot of plots for this kind of thing by using <strong>plot(model)</strong></p>
<p>Here’s what it looks like for a nice neat model:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(my_model)</span></code></pre></div>
<p><img src="07_regression_files/figure-html/unnamed-chunk-57-1.png" width="80%" style="display: block; margin: auto;" /></p>
<hr />
<div class="lo">
<p>Some people don’t like the higher-level/broad picture approach to thinking about assumptions of our analysis, and prefer a step-by-step list of things to make sure they tick off. For those of you who would like this, you can find our page on <a href="zz_assumpt.html">“assumptions &amp; diagnostics: the recipe book way”</a>.</p>
</div>
</div>
<p>Recall our last model (from Question C5), in which we fitted a model assessing how we might explain wellbeing by the combination of social interactions, routine, and outdoor time.<br />
The code for this model is given below.<br />
Let’s take a look at the diagnostic plots given by passing the model to the <code>plot()</code> function.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>mwdata <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="st">&quot;https://uoepsy.github.io/data/wellbeing.csv&quot;</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>wbmodel2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wellbeing <span class="sc">~</span> social_int <span class="sc">+</span> routine <span class="sc">+</span> outdoor_time, <span class="at">data=</span>mwdata)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wbmodel2)</span></code></pre></div>
<p><img src="07_regression_files/figure-html/unnamed-chunk-59-1.png" width="80%" style="display: block; margin: auto;" />
The model doesn’t look too bad.</p>
<div class="int">
<ul>
<li>The top left plot (residuals vs fitted) shows a reasonably straight red line, which indicates that the mean of the residuals is close to zero across the fitted values.<br />
</li>
<li>The top right plot (QQplot of residuals) shows that the residuals are fairly close to the dotted line, indicating they follow close to a normal distribution <em>(QQplots plot the values against the associated percentiles of the normal distribution. So if we had ten values, it would order them lowest to highest, then plot them on the y against the 10th, 20th, 30th.. and so on percentiles of the standard normal distribution (mean 0, SD 1))</em>.<br />
</li>
<li>The bottom left plot (scale location plot) shows the square-root of the absolute value of the standardised residuals. This allows us to examine the extent to which the variance of the residuals changes accross the fitted values. A straight red line indicates reasonably constant variance. It’s a bit wiggly here!<br />
</li>
<li>The bottom right plot (residuals vs leverage plot) shows the extent to which datapoints that have higher residuals (are far away from our regression line) have the potential to unduly influence our line. We’ll look at this idea of influence later on.</li>
</ul>
</div>
<div class="question-begin">
Question Optional: D1
</div>
<div class="question-body">
<p>We can perform tests to examine how (un)likely we would be to see some residuals like those we have got, if they were sampled from a normally distribution.</p>
<p>The Shapiro-Wilk test is a test against the alternative hypothesis that the residuals were not sampled from a normally distributed population. We can perform this test quickly in R using <code>shapiro.test(residuals(modelname))</code>.<br />
Conduct this test now on the model we just plotted above. What do you conclude?</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-122" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-122&#39;, &#39;sol-start-122&#39;)"> Solution </span>
</div>
<div id="sol-body-122" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(<span class="fu">residuals</span>(wbmodel2))</span></code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  residuals(wbmodel2)
## W = 0.96791, p-value = 0.4439</code></pre>
<div class="int">
<p>A Shapiro-Wilk test failed to reject the null hypothesis that the residuals were drawn from a normally distributed population (<span class="math inline">\(W = 0.97\)</span>, <span class="math inline">\(p = .44\)</span>)</p>
</div>
</div>
<p class="question-end">
</p>
<div class="question-begin">
Question Optional: D2
</div>
<div class="question-body">
<p>The <code>ncvTest(model)</code> function (from the <strong>car</strong> package) performs a test against the alternative hypothesis that the error variance changes with the level of the fitted value (also known as the “Breusch-Pagan test”). <span class="math inline">\(p &gt;.05\)</span> indicates that we do <em>not</em> have evidence that the assumption has been violated.<br />
Try conducting this test now, on the same model as the previous question.</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-123" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-123&#39;, &#39;sol-start-123&#39;)"> Solution </span>
</div>
<div id="sol-body-123" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ncvTest</span>(wbmodel2)</span></code></pre></div>
<pre><code>## Non-constant Variance Score Test 
## Variance formula: ~ fitted.values 
## Chisquare = 0.1018826, Df = 1, p = 0.74958</code></pre>
<div class="int">
<p>Visual inspection of suggested little sign of non-constant variance, with the Breusch-Pagan test failing to reject the null that error variance does not change across the fitted values (<span class="math inline">\(\chi^2(1)=0.102\)</span>, <span class="math inline">\(p = .75\)</span>)</p>
</div>
</div>
<p class="question-end">
</p>
<div class="statbox">
<p><strong>Multicollinearity</strong></p>
For the linear model with multiple explanatory variables, we need to also think about <strong>multicollinearity</strong> - this is when two (or more) of the predictors in our regression model are moderately or highly correlated.<br />
Recall our interpretation of multiple regression coefficients as<br />

<center>
“the effect of <span class="math inline">\(x_1\)</span> on <span class="math inline">\(y\)</span> when <em>holding the values of <span class="math inline">\(x_2\)</span>, <span class="math inline">\(x_3\)</span>, … <span class="math inline">\(x_k\)</span> constant</em>”
</center>
<p>This interpretation falls down if predictors are highly correlated because if, e.g., predictors <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span> are highly correlated, then changing the value of <span class="math inline">\(x_1\)</span> necessarily entails a change the value of <span class="math inline">\(x_2\)</span> meaning that it no longer makes sense to talk about <em>holding <span class="math inline">\(x_2\)</span> constant.</em><br />
<br>
We can assess multicollinearity using the <strong>variance inflation factor (VIF)</strong>, which for a given predictor <span class="math inline">\(x_j\)</span> is calculated as:<br />
<span class="math display">\[
VIF_j = \frac{1}{1-R_j^2} \\
\]</span>
Where <span class="math inline">\(R_j^2\)</span> is the coefficient of determination (the R-squared) resulting from a regression of <span class="math inline">\(x_j\)</span> on to all the other predictors in the model (<span class="math inline">\(x_j = x_1 + ... x_k + \epsilon\)</span>).<br />
The more highly correlated <span class="math inline">\(x_j\)</span> is with other predictors, the bigger <span class="math inline">\(R_j^2\)</span> becomes, and thus the bigger <span class="math inline">\(VIF_j\)</span> becomes.<br />
<br>
The square root of VIF indicates how much the SE of the coefficient has been inflated due to multicollinearity. For example, if the VIF of a predictor variable were 4.6 (<span class="math inline">\(\sqrt{4.6} = 2.1\)</span>), then the standard error of the coefficient of that predictor is 2.1 times larger than if the predictor had zero correlation with the other predictor variables. Suggested cut-offs for VIF are varied. Some suggest 10, others 5. Define what you will consider an acceptable value <em>prior</em> to calculating it.</p>
<div class="rtip">
<p><strong>In R</strong>, the <code>vif()</code> function from the <strong>car</strong> package will provide VIF values for each predictor in your model.</p>
</div>
</div>
<div class="question-begin">
Question Optional: D3
</div>
<div class="question-body">
<p>Calculate the variance inflation factor (VIF) for the predictors in the model.</p>
<p>Write a sentence summarising whether or not you consider multicollinearity to be a problem here.</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-124" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-124&#39;, &#39;sol-start-124&#39;)"> Solution </span>
</div>
<div id="sol-body-124" class="solution-body" style="display: none;">
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(wbmodel2)</span></code></pre></div>
<pre><code>##   social_int      routine outdoor_time 
##     1.130708     1.014136     1.142259</code></pre>
<div class="int">
<p>VIF values &lt;5 indicate that multicollinearity is not adversely affecting model estimates.</p>
</div>
</div>
<p class="solution-end">
</p>
</div>
<div id="individual-case-diagnostics" class="section level2">
<h2>Individual Case Diagnostics</h2>
<div class="statbox">
<p>In linear regression, individual cases in our data can influence our model more than others. There are a variety of measures we can use to evaluate the amount of misfit and influence that single observations have on our model and our model estimates.</p>
<div class="imp">
<p><strong>THERE ARE NO HARD RULES FOR WHAT COUNTS AS “INFLUENTIAL” AND HOW WE SHOULD DEAL WITH THESE CASES</strong></p>
<p>There are many ways to make a cake. recipes can be useful, but you really need to think about what ingredients you actually have (what data you have).</p>
<p>You don’t <strong>have</strong> to exclude influential observations. Try to avoid blindly following cut-offs, and try to think carefully about outliers and influential points and whether you want to exclude them, and whether there might be some other model specification that captures this in some estimable way. Do these observations change the conclusions you make (you can try running models with and without certain cases).</p>
</div>
<p>There are various measures of outlyngness and influence.
Here are a few. <b style="color:red">You do not need to remember all of these!</b></p>
<p><strong>Regression outliers:</strong><br />
A large residual <span class="math inline">\(\hat \epsilon_i\)</span> - i.e., a big discrepancy between their predicted y-value and their observed y-value.</p>
<ul>
<li><strong>Standardised residuals:</strong> For residual <span class="math inline">\(\hat \epsilon_i\)</span>, divide by the estimate of the standard deviation of the residuals. In R, the <code>rstandard()</code> function will give you these</li>
<li><strong>Studentised residuals:</strong> For residual <span class="math inline">\(\hat \epsilon_i\)</span>, divide by the estimate of the standard deviation of the residuals excluding case <span class="math inline">\(i\)</span>. In R, the <code>rstudent()</code> function will give you these. Values <span class="math inline">\(&gt;|2|\)</span> (greater in magnitude than two) are considered <em>potential</em> outliers.</li>
</ul>
<p><strong>High leverage cases:</strong><br />
These are cases which have considerable <em>potential</em> to influence the regression model (e.g., cases with an unusual combination of predictor values).</p>
<ul>
<li><strong>Hat values:</strong> are used to assess leverage. In R, The <code>hatvalues()</code> function will retrieve these.<br />
Hat values of more than <span class="math inline">\(2 \bar{h}\)</span> (2 times the average hat value) are often worth looking at. <span class="math inline">\(\bar{h}\)</span> is calculated as <span class="math inline">\(\frac{k + 1}{n}\)</span>, where <span class="math inline">\(k\)</span> is the number of predictors, and <span class="math inline">\(n\)</span> is the sample size.</li>
</ul>
<p><strong>High influence cases:</strong><br />
When a case has high leverage <em>and</em> is an outlier, it will have a large influence on the regression model.</p>
<ul>
<li><strong>Cook’s Distance:</strong> combines <em>leverage</em> (hatvalues) with <em>outlying-ness</em> to capture influence. In R, the <code>cooks.distance()</code> function will provide these.<br />
There are many suggested <a href="https://en.wikipedia.org/wiki/Cook%27s_distance#Detecting_highly_influential_observations">Cook’s Distance cut-offs</a>.</li>
<li><strong>DFFit:</strong> the change in the predicted value at the <span class="math inline">\(i^{th}\)</span> observation with and without the <span class="math inline">\(i^{th}\)</span> observation is included in the regression.<br />
</li>
<li><strong>DFbeta:</strong> the change in a specific coefficient with and without the <span class="math inline">\(i^{th}\)</span> observation is included in the regression.<br />
</li>
<li><strong>DFbetas:</strong> the change in a specific coefficient divided by the standard error, with and without the <span class="math inline">\(i^{th}\)</span> observation is included in the regression.<br />
</li>
<li><strong>COVRATIO:</strong> measures the effect of an observation on the covariance matrix of the parameter estimates. In simpler terms, it captures an observation’s influence on standard errors. Values which are <span class="math inline">\(&gt;1+\frac{3(k+1)}{n}\)</span> or <span class="math inline">\(&lt;1-\frac{3(k+1)}{n}\)</span> are <em>sometimes</em> considered as having strong influence.</li>
</ul>
<div class="rtip">
<p>You can get a whole bucket-load of these measures with the <code>influence.measures()</code> function.</p>
<ul>
<li><code>influence.measures(my_model)</code> will give you out a dataframe of the various measures.<br />
</li>
<li><code>summary(influence.measures(my_model))</code> will provide a nice summary of what R deems to be the influential points.</li>
</ul>
</div>
</div>
<div class="question-begin">
Question Optional: D4
</div>
<div class="question-body">
<p>Plot the Cook’s Distance values, does it look like there may be any highly influential points?<br />
(You can use <code>plot(model, which = 4)</code> and <code>plot(model, which = 5)</code>).</p>
</div>
<p class="question-end">
</p>
<div class="solution-begin">
<span id="sol-start-125" class="fa fa-chevron-circle-right solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-125&#39;, &#39;sol-start-125&#39;)"> Solution </span>
</div>
<div id="sol-body-125" class="solution-body" style="display: none;">
<p>These don’t look too bad to me - there aren’t a small number of cases which have exceptionally high values (relative to the others) for Cook’s D.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wbmodel2, <span class="at">which =</span> <span class="dv">4</span>)</span></code></pre></div>
<p><img src="07_regression_files/figure-html/unnamed-chunk-63-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(wbmodel2, <span class="at">which =</span> <span class="dv">5</span>)</span></code></pre></div>
<p><img src="07_regression_files/figure-html/unnamed-chunk-63-2.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<p class="solution-end">
</p>
<div class="tocify-extend-page" data-unique="tocify-extend-page" style="height: 0;">

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>
<span class="math inline">\(SS_{Total}\)</span> has <span class="math inline">\(n - 1\)</span> degrees of freedom as one degree of freedom is lost in estimating the population mean with the sample mean <span class="math inline">\(\bar{y}\)</span>.
<span class="math inline">\(SS_{Residual}\)</span> has <span class="math inline">\(n - 2\)</span> degrees of freedom. There are <span class="math inline">\(n\)</span> residuals, but two degrees of freedom are lost in estimating the intercept and slope of the line used to obtain the <span class="math inline">\(\hat y_i\)</span>s.
Hence, by difference, <span class="math inline">\(SS_{Model}\)</span> has <span class="math inline">\(n - 1 - (n - 2) = 1\)</span> degree of freedom.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>

<div>
  <hr/>
  <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br/>
  This workbook was written by Josiah King, Umberto Noe, and Martin
  Corley, and is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
