---
title: "USMR 2021-2022 Coursework"
author: "`r params$examnumber`"
date: "`r Sys.Date()`"
output:
  word_document: default
  pdf_document: default
  html_document: default
params:
  examnumber: "B192025"
---

<!-- We have provided a template below with headings/sub-headings for each question/sub-question. This is just a template. Feel free to add or delete code-chunks if desired.  -->
<!-- Beneath here is some code which will set everything up for you.  Anything that is needed to run your code should be explicitly set up below -->

```{r setup, include=FALSE}
# this line will mean that when you compile/knit your document, 
# the code will not show, but the output (e.g., plots) will!
knitr::opts_chunk$set(echo = FALSE)
# this line means all numeric output gets rounded to 3 dp
options(digits=3)
# load any other packages that you require here:
library(tidyverse)
# This will read in your own personal data:
source("https://uoepsy.github.io/data/usmr_2122_data.R")
```

# Question 0: Cleaning and Describing
# Have a look at the data. Check for impossible values and deal with these in an appropriate manner. Describe the data, either in words or using suitable graphs (or a combination). Remember to detail the decisions you have made.


<!-- If you have run the R code above this point (you can do this now by pressing Ctrl-Shift-Alt-P, or running the chunk above) then your data will be in a dataframe called `couchto5k`. -->
#In the R code below, I created a new subset of data by filtering values that would be impossible per the information provided about the data set. By doing so, I removed 5 of the original 138 rows, leaving 133 rows.  I then noticed that 5 instances of the word "autumn" were spelled incorrectly in the data, so I changed them to the correct spelling.

```{r cleaning, include = FALSE}
# Neither output nor code from this chunk will be shown in the compiled document. 

#Clean the data by excluding impossible values
couchto5kCleaned <- couchto5k %>% filter(age<=100 & accountability<=36 & accountability>=4 & selfmot<= 35 & selfmot>=5 & health>=0 & health<=100 & happiness>=0 & happiness<=100 & week_stopped>=1 & week_stopped<=9)

#Correct the instances of Autumn that are misspelled.
couchto5kCleaned[15,7] <- "autumn"
couchto5kCleaned[29,7] <- "autumn"
couchto5kCleaned[66,7] <- "autumn"
couchto5kCleaned[82,7] <- "autumn"
couchto5kCleaned[121,7] <- "autumn"

```
# In the code below, I generated a summary of the R data to describe some information about the couchto5kCleaned dataset.
```{r descriptives}
# Code will not be shown from this chunk (because we set echo = FALSE in the very first chunk)
# the output from this code will be shown. 

#summary of couchto5kCleaned is seen below
summary(couchto5kCleaned)

```

# Question 1 General Checks

## Question 1a: In an earlier nationwide survey, researchers found that 45% of participants abandoned the programme before the halfway point in week 5, and a further 10% gave up before the end of the programme. Is the data in the sample you have been given in line with data from the earlier survey? Once you have created a suitable variable to map to the information in the question, you should be able to answer this using a simple statistical test.

#To answer this question, I created a table with the number of how many individuals left the programme at each week to gain information on how this data was distributed.  I added the number of participants that left the programme prior to week 5 and stored in a variable, and did the same for those that left in week 8, and lastly for those who completed the program.  The data is not in line with the previous test.  Those who left prior to week 5 comprised 37.6% of participants, those who left prior to week 9 comprised 14.3% of participants, and those that completed the programme comprised 48.1% of participants.  This data is not in line with the data from the earlier survey.

```{r q1a}
#below is code for a table to show in which weeks participants exited the programme
table(couchto5kCleaned$week_stopped)

#create variables to represent participants who dropped out before week 5, participants who dropped out before week 9, and participants that completed the programme
firstHalf <- 12+16+6+16  #determining the number dropping out before week 5
nextForty <- 5+1+2+11   #determining the number dropping out before week 9
lastTen <-64  #determining the number finishing the program

```

## Question 1b: Using the same three categories (stopped before week 5, stopped after week 5, completed), examine whether the patterns of attrition rates differ by city.
#The patterns of attrition do differ by city.  To answer this question, I created a table based on participants' exit from the programme between the two cities.  40.4% of Edinburgh participants exitted the programme prior to week 5 compared to 30.8% of Glasgow participants.  9.57% of Edinburgh participants exitted the programme within the next four weeks compared to 25.6% of Glasgow participants.  Lastly, 5% of Edinburgh participants completed the programme, compared to 4.36% of Glasgow participants.
```{r q1b}
#create a table of which weeks participants stopped and by which city
table(couchto5kCleaned$week_stopped, couchto5kCleaned$city)
#create variables for the weeks participants stopped in both Edinburgh and Glasgow
firstHalfEdinburgh <- 9+13+6+10
nextFortyEdinburgh <- 3+0+1+5
lastTenEdinburgh <- 47
firstHalfGlasgow <- 3+3+0+6
nextFortyGlasgow <- 2+1+1+6
lastTenGlasgow <- 17
firstHalfEdinburgh/94
nextFortyEdinburgh/94
lastTenEdinburgh/94
firstHalfGlasgow/39
nextFortyGlasgow/39
lastTenGlasgow/39

```

## Question 1c: Do the average ages of participants who commenced the programme differ by city?
# To answer this question, I first created a subset of Glasgow participants, and then a subset of Edinburgh participants.  I then calculated the means of the ages of each subset.  Edinburgh runners are slightly older at an average age of 41.3, than the Glasgow runners at an average age of 37.1

```{r q1c}
#create a subset of participants from Edinburgh and participants from Glasgow
couchto5kGlasgow <- subset(couchto5kCleaned, city=="Glasgow")
couchto5kEdinburgh <- subset(couchto5kCleaned, city=="Edinburgh")

#find the mean age of each group
mean(couchto5kGlasgow$age)
mean(couchto5kEdinburgh$age)
```

# Question 2 Happiness

## Question 2a: Are participants’ happiness ratings affected by the season they were interviewed in? Describe the way in which season influences happiness outcomes.
#To answer this question, I first created a scatter plot with season on the x-axis and happiness on the y-axis.  Upon first glance, it appears that the participances interviewed in spring and summer have a much higher likelihood of feeling happy that those interviewed in the autumn or winter.  I also created a model of this data.  The model reflected a p value of 0.0224 meaning that the findings are statistically signficant, with standard error and t values of 8.24 and 4.67 for autumn, 9.20 and 2.03 for spring, 9.49 and 1.14 for summer, and  12.67 and -0.76 for winter.

```{r q2a}
#create a plot of happiness as it relates to seasons
ggplot(couchto5kCleaned, aes(x=season, happiness))+
  geom_point()
#model of relationship of season to happiness
seasonmod <- lm(happiness ~ season, data=couchto5kCleaned)
summary(seasonmod)

```

## Question 2b: Accounting for any effects you discovered in (2a), is happiness affected by age?
#To answer this question, I first created a scatter plot with age on the x-axis and happiness on the y-axis.  By glancing at the scatterplot, I cannot make any assumptions about the correlation between age and happiness. However, I did solve for the correlation coefficient between age and happiness and the value is 0.188 which means that there is some positive correlation between age and happiness.  The p value is p-value: 0.02 causing this to be statistically significant.
```{r q2b}
#create a plot of happiness as it relates to age
ggplot(couchto5kCleaned, aes(x=age, happiness))+
  geom_point()
#correlation of age to happiness
cor(x = couchto5kCleaned$age, y = couchto5kCleaned$happiness)
#model of relationship of age to happiness
agemod <- lm(happiness ~ age, data=couchto5kCleaned)
summary(agemod)
```

## Question 2c: The models you have built above explore ‘baseline’ effects; that is, effects that are not of primary interest to the researchers but which might affect the outcome variable of happiness. For use in question 3, pick a specific baseline model and justify why you are using this.
#Below I have completed a multiple linear regression in order to determine the better baseline model to use in question 3.  Based on the information displayed in the summary of the model I plan to choose the season-happiness model.  This is because there appears to be a stronger correlation between season and happiness.  Additionally, the p value is lower in the season-happiness model than in the age-happiness model, which reduces the risk of these outcomes being found in error.

```{r q2c}
#running a multiple linear regression of happiness, age, season
bothmod <- lm(happiness ~ age + season, data=couchto5kCleaned)
summary(bothmod)
```

# Question 3 Happiness and Health

## Question 3a: Building on your baseline model, are participants’ happiness ratings affected by whether or not they completed the programme? Describe the way in which programme completion influences happiness outcomes.

# Based on the information in 2c I opted to choose the season-happiness model as the baseline model for this question.  Below, I built a model of programme completion and happiness, as well as created a scatterplot of this information.  I then created a multiple linear regression of season, programme completion, and happiness.  The data indicates below that there is a statistically significant correlation between programme completion and happiness outcomes.

```{r q3a}
#scatterplot of week participants left the programme (x axis) and happiness (y axis)
ggplot(couchto5kCleaned, aes(x=week_stopped, happiness))+
  geom_point()

#model of relationship of weeks completed to happiness
weeksmod <- lm(happiness ~ week_stopped, data=couchto5kCleaned)
summary(weeksmod)

#running a multiple linear regression of happiness, weeks completed, season
WeeksSeasonHappinessmod <- lm(happiness ~ week_stopped + season, data=couchto5kCleaned)
summary(WeeksSeasonHappinessmod)

```

## Question 3b: Building on the analysis in (3a), is happiness additionally affected by the “health metric”?

#Below, I built a model of the health metric and happiness, as well as created a scatterplot of this information.  I then created a multiple linear regression of health, season, programme completion, and happiness.  The data indicates below that there is a statistically significant correlation between programme completion and happiness outcomes.  The model of the relationship between health to happiness demonstrates a p value of 0.884, demonstrating that no effect was observed statistically.  Running the multiple linear regression demonstrated positive correlation between all variables combined and happiness, with a p value of 0.0375.

```{r q3b}
#scatterplot of health metrics (x axis) and happiness (y axis)
ggplot(couchto5kCleaned, aes(x=health, happiness))+
  geom_point()

#model of relationship of health to happiness
healthmod <- lm(happiness ~ health, data=couchto5kCleaned)
summary(healthmod)

#running a multiple linear regression of happiness, weeks completed, health, and season
WeeksSeasonHappinessHealthmod <- lm(happiness ~ week_stopped + season + health, data=couchto5kCleaned)
summary(WeeksSeasonHappinessHealthmod)
```

## Question 3c: It’s been hypothesised that the effects of good health are amplified by the feeling of acting healthily, such that the happiness of participants who got further along the programme might be more affected by the health metric than that of those who stopped earlier. Building on the model in (3b), can you test this hypothesis?
#To answer this question, I first created three subsets based on the week that participants ended the programme.  The first subset is based on participants who left the programme prior to week 5, the second subset is based on those who left within the next four weeks, and the last is based on those who completed the programme (this subset was created in an earlier part of this project).  Next, I created models of each of the three subsets related to happiness and created scatterplots for each as well.  For the group of participants who ended their partication before week 5, there was a negative correlation between health and happiness with a p value of 0.00233. For the group of participants who ended their participation between week 5 and week 8, there was a positive correlation between health and happiness, however, this was not statistically significant as the p value was 0.519.  For the group of participants who completed the programme, there was an even larger positive correlation between health and happiness, and this was statistically significant with a p value of 0.0433.  This indicates that the hypothesis is accurate that the health metric impacts the happiness of those who progressed further in the programme.

```{r q3c}
#subset of those who left programme before week 5
couchto5kfirsthalf <- subset(couchto5kCleaned, week_stopped<5)
#subset of those who left programme between week 5 and week 8
couchto5knextfour <- subset(couchto5kCleaned, week_stopped>=5 & week_stopped<9)
couchto5kFinished <- subset(couchto5kCleaned, week_stopped=9)


#model of the participants who left before week 5 - health and happiness
FirstHealthMod <- lm(happiness ~ health, data=couchto5kfirsthalf)
summary(FirstHealthMod)
#plot of the participants who left before week 5 - health and happiness
ggplot(couchto5kfirsthalf, aes(x=health, happiness))+
  geom_point()

#model of the participants who left between week 5 and week 8 - health and happiness
SecondHealthMod <- lm(happiness ~ health, data=couchto5knextfour)
summary(SecondHealthMod)
#plot of the participants who left between week 5 and week 8 - health and happiness
ggplot(couchto5knextfour, aes(x=health, happiness))+
  geom_point()

#model of the participants who completed the programme - health and happiness
ThirdHealthMod <- lm(happiness ~ health, data=couchto5kFinished)
summary(ThirdHealthMod)


```

## Question 3d: What can we conclude about the various causes of happiness in our data? Write a brief description of the effects in the model, such as you might find in an academic paper.
#Our data provides important insight on impact of health, programme progression and completion, location, and season on happiness.  Firstly, health plays an important role in happiness, and this effect becomes greater as individuals progress further toward their goals.  Additionally, individuals tend to become more happy as they become closer to completing the programme.  There is also a correlation between age and happiness, and an even larger correlation between season and happiness.  For season and happiness, individuals were found to be most happy in the spring and summer.

# Question 4: Create a subset of the data, including only those participants who completed the programme. Create a plot of the average happiness ratings grouped by season and city, that can be used in a presentation to the funders of the project.
# To answer this question, I first created a subset with only the participants who completed the programme.  Then, using that new subset, I created a facet plot that showed the two cities, the four seasons, and participant happiness.

```{r q4}
#below is a subset that includes the 64 participants that completed all nine weeks of the programme.
couchto5kCompleted <- subset(couchto5kCleaned, week_stopped>=9)

#below is a facet plot that demonstrates the interaction between happiness, season, and city.
p <- ggplot(data = couchto5kCompleted, aes(x = season, y = happiness)) + geom_point()
p + facet_wrap(~city)

```


# Question 5 Predictors of Drop-out

## Question 5a: Build a model that predicts the likelihood of dropping out (at all).

#Below, I created a model that predicts the likelihood of dropping out of the programme.  I did this by assigning a "1" value to those who remained in the programme, and a 0 value to those who dropped out.  51.9% of participants dropped out of the programme.

```{r q5a}

#create a column where participants who complete through week 9 are assigned a "1" value and participants who drop out sooner are assigned a "0" value
couchto5kDropOut <- couchto5kCleaned %>%
    mutate(is_out = 
             ifelse(week_stopped=="9",1,0))
couchto5kDropOut

#model for dropping out
model <- glm(formula= is_out ~ age + accountability + selfmot + health + happiness + season + city, data=couchto5kDropOut, family=binomial)
summary(model)



```

## Question 5b: Briefly describe the effects in your model as you would in an academic paper.
#The model above provides information on the probability of an individual dropping out based on the conditions provided by the data.  This information is broken into information on age, city, self motivation, happiness, health, accountability, and season.

```{r q5b}

```

## Question 5c: Draw a graph representing the probability of quitting as a function of how self motivated participants were.
#In order to answer this question, I utilized a similar method to the first part of question 5.  I then created a scatterplot which reveals that those with higher levels of self-motivation are less likely to quit and those with lower levels of self-motivation are more likely to quit.

```{r q5c}
#scatter plot of weeks stopped as related to self motivation
#model for dropping out
couchto5kDropOutBin <- couchto5kDropOut %>%
  mutate(bin=cut_interval(selfmot,10))
dat <- couchto5kDropOutBin %>% group_by(bin) %>%
  summarise(prop=mean(is_out))
dat %>% ggplot(aes(x=bin,y=prop)) +
  xlab("Self-Motivation") + ylab("Probability of Completing Programme") +
  geom_point(size=3) +
  scale_x_discrete(label=1:10)
```










