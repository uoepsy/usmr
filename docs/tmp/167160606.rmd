---
title: "USMR 2021-2022 Coursework"
author: "`r params$examnumber`"
date: "`r Sys.Date()`"
output:
  word_document: default
  html_document: default
  pdf_document: default
params:
  examnumber: B174869
---

<!-- We have provided a template below with headings/sub-headings for each question/sub-question. This is just a template. Feel free to add or delete code-chunks if desired.  -->
<!-- Beneath here is some code which will set everything up for you.  Anything that is needed to run your code should be explicitly set up below -->

```{r setup, include=FALSE}
# this line will mean that when you compile/knit your document, 
# the code will not show, but the output (e.g., plots) will!
knitr::opts_chunk$set(echo = FALSE)
# this line means all numeric output gets rounded to 3 dp
options(digits=3)
# load any other packages that you require here:
library(tidyverse)
library(ggplot2)
library(psych)
# This will read in your own personal data:
source("https://uoepsy.github.io/data/usmr_2122_data.R")
```

# Question 0
<!-- If you have run the R code above this point (you can do this now by pressing Ctrl-Shift-Alt-P, or running the chunk above) then your data will be in a dataframe called `couchto5k`. -->


```{r cleaning, include = FALSE}
# Neither output nor code from this chunk will be shown in the compiled document. 

#look at dataset and look for weird things
describe(couchto5k)
#look at age. there are 2 values over 100 that are unreasonable. set cutoff at 100
df=subset(couchto5k,age<=100)
#look at self mot. values below 0 and over 35 are unreasonable. remove. 
df=subset(df,selfmot<=35)
df=subset(df,selfmot>=0)
#one value in week stopped is unreasonable. remove.
df=subset(df,week_stopped<=9)
#autumn is misspelled
df["season"] [df["season"]=="autunm"]<-"autumn"
#the other columns have reasonable values no clean up needed
```

```{r descriptives}
# Code will not be shown from this chunk (because we set echo = FALSE in the very first chunk)
# the output from this code will be shown. 

# Plot age and health in one graph to see the correlation between age of participant and their health during participation in the 5k

plot(df$age, df$health, main = "Relationship Between Age and Health", xlab = "Age (Years)", ylab = "Health (%)", col= "red")


#Plot self-motivation and happiness in one graph to see the correlation between them

plot(df$happiness, df$selfmot, main = "Relationship Between Happiness and Self-Motivation", xlab = "Happiness (%)", ylab = "Self-motivation (/35)", col = "plum3")

#number of participants and the week they stopped
hist(df$week_stopped, main = "No. of Participants and the Week Stopped", xlab = "Week Stopped", ylab = "No. of Participants", col=c("firebrick4","darkolivegreen"))

boxplot(df$happiness~df$season, main = "Relationship Between Seasons and Happiness", xlab = "Season", ylab = "Happiness", col=c("firebrick4","springgreen3","gold1","steelblue"))

boxplot(df$age~df$city, main = "Age of Participants in Edinburgh & Glasgow", xlab = "City", ylab = "Age", col=c("firebrick4","slategray"))

```

# Question 1 

## Question 1a

```{r q1a}
#add new column with weeks and set all weeks under 5 to 1, over 5 to 2 and all weeks at 9 will be 0. This way we can use this new variable to perform a test
df$weeks<- df$week_stopped
df["weeks"] [df["week_stopped"]<=5]<-1
df["weeks"] [df["week_stopped"]>5]<-2
df["weeks"] [df["week_stopped"]==9]<-0


table(df$weeks)

# for the dataset provided, out of the 128 participants 49 (38.3%) quit before week 5, 15 (11.7%) quit after week 5 and 64 (50%) completed.
cat1=(0.383-0.45)^2/0.45
cat2= (0.117-0.055)^2/0.055
cat3=(0.5-0.495)^2/0.495
chisquare=sum(cat1,cat2,cat3)
1-pchisq(chisquare,2)
#p value is 0.96 which means the data is not significantly different. Null hypothesis is not rejected. The observed dataset is in line with the survey.
```

## Question 1b

```{r q1b}
boxplot(df$weeks~df$city, main = "Attrition Rates in Edinburgh & Glasgow", xlab = "City", ylab = "Week Stopped", col=c("firebrick4","slategray"))
#Graph shows no significant difference in attrition rates between cities

edinburgh=subset(df,city=='Edinburgh')
ediweek1=nrow(edinburgh)
ediweek5=subset(edinburgh,weeks=1)
ediweek5n=nrow(ediweek5)
ediweek9=subset(edinburgh,weeks=0)
ediweek9n=nrow(ediweek9)
#week 1 in edinburgh had 90. week 5 has 57 people which is a 36.7% decline week 9 46 people which 12.3% from week 5. week 9 is 51%
#category 1 has 90-57 which is 33. cat 2 is 57-46 which is 11 and cat 3 is 46. cat1 0.367 cat 2 0.123 and cat 3 is 0.51
glasgow=subset(df,city=='Glasgow')
glasweek1=nrow(glasgow)
glasweek5=subset(glasgow,weeks=1)
glasweek5n=nrow(glasweek5)
glasweek9=subset(glasgow,weeks=0)
glasweek9n=nrow(glasweek9)
#week 1 in glasgow had 38. week 5 had 23 week 9 had 18.
#category 1 has 38-23 which is 15. cat 2 is 23-18 which is 5 and cat 3 18
#cat 1 is 0.395 cat 2 is 0.132 and cat 3 is 0.473
#edinburgh is designated as observed and glasgow is expected 
edicat1=(0.367-0.395)^2/0.395
edicat2= (0.123-0.132)^2/0.132
edicat3=(0.51-0.473)^2/0.473
edichisquare=sum(edicat1,edicat2,edicat3)
1-pchisq(edichisquare,2)
#p value is 0.997 there is no difference between the cities. If the observed and expected were reversed the p value would not change. 

```

## Question 1c

```{r q1c}
ediaveage=mean(edinburgh$age)
glasaveage=mean(glasgow$age)
describeBy(df,df$city)
# ave age of edinburgh is 38.8 ave age of glasgow is 37. They differ but not greatly. It is noticeable that the number of participants in each city vary Edinburgh having 90 participants and Glasgow having 38.The range is also different as Edinburgh's range is 42 and Glasgow's is 35.
boxplot(df$age~df$city, main = "Age of Participants in Edinburgh & Glasgow", xlab = "City", ylab = "Age", col=c("firebrick4","slategray"))
#The graph illustrates that there is no significant difference in ages between cities.
```

# Question 2
## Question 2a

```{r q2a}
shapiro.test(df$happiness)
ggplot(data = df, aes(x = happiness)) + 
  geom_histogram(bins=15)
#the distribution is not normal so will use linear regression model
df$seasons<- 0
df["seasons"] [df["season"]=="winter"]<-4
df["seasons"] [df["season"]=="summer"]<-2
df["seasons"] [df["season"]=="spring"]<-1
df["seasons"] [df["season"]=="autumn"]<-3

summary(lm(df$happiness~df$season))
reg1<-lm(df$happiness~df$seasons)
summary(reg1)
(plot(df$seasons,df$happiness))
#linear model shows no significant relationship between seasons interviewed and happiness outcome. The graph shows that there might be some change between the warmer seasons as opposed to the colder seasons however no change can be evidenced by the observed data.

```

## Question 2b

```{r q2b}
#linear regression for happiness and age
summary(lm(df$happiness~df$age))
agehap<-plot(df$age,df$happiness)
agehap
Agehaaps<-lm(df$happiness~df$age)
plot(Agehaaps)
AgeHap<-ggplot(df,aes(x=age,y=happiness))+
  geom_point()+
  geom_abline(intercept=48.9126,slope=-0.0318,color='blue')
plot(AgeHap)
#There is no relationship between age and happiness in the observed dataset
```

## Question 2c
# The baseline model ideal for question 3 would be the linear regression model used in both questions 2a and 2b. The data observed for the Happiness variable is shown to not have a normal distribution and therefore a T test or ANOVA cannot be conducted. The best model to use for data that is not normal would be a linear regression model. Since question 3 also requires the use of the Happiness variable, it would be apt to use a linear regression model.
```{r q2c}
# The baseline model ideal for question 3 would be the linear regression model used in both questions 2a and 2b. The data observed for the Happiness variable is shown to not have a normal distribution and therefore a T test or ANOVA cannot be conducted. The best model to use for data that is not normal would be a linear regression model. Since question 3 also requires the use of the Happiness variable, it would be apt to use a linear regression model.
```

# Question 3

## Question 3a

```{r q3a}
summary(lm(df$happiness~df$week_stopped))
Hapstop<-plot(df$week_stopped,df$happiness)

hapstop<-ggplot(df,aes(x=week_stopped,y=happiness))+
  geom_point()+
  geom_abline(intercept=56.264,slope=-1.357,color='blue')
plot(hapstop)
# The observed data shows that programme completion led to decreased happiness outcomes. However the linear regression model shows that this relationship had weak significance.
```

## Question 3b

```{r q3b}
summary(lm(df$happiness~df$health))
haphealthlm<-lm(df$happiness~df$health)
plot(haphealthlm)
Haphealth<-plot(df$health,df$happiness)

haphealth<-ggplot(df,aes(x=health,y=happiness))+
  geom_point()+
  geom_abline(intercept=34.435 ,slope=-0.233,color='blue')
plot(haphealth)
# There is no likely significant relationship between health and happiness in the observed dataset
```

## Question 3c

```{r q3c}
hapheastop<- lm(df$happiness~df$health+df$week_stopped)
summary(hapheastop)
plot(hapheastop)

Hapheastop<-ggplot(df,aes(x=health+week_stopped,y=happiness))+
  geom_point()+
  geom_abline(intercept=44.788 ,slope=0.196*-1.307,color='blue')
plot(Hapheastop)
# A multiple regression model was used to find the relationship between happiness, health and the week stopped. There was no likely significance found.
```

## Question 3d


# Question 4

```{r q4}
completed=subset(df,week_stopped==9)
ggplot(completed, aes(x = completed$season, y = completed$happiness)) +
  geom_point() + 
  facet_wrap(~city)+
  labs(x="Seasons", y= "Happiness")
# Made a subset of all participants that completed at week 9. Then plotted happiness according to city and season 

```


# Question 5

## Question 5a

```{r q5a}
df$dropout<- df$week_stopped
df["dropout"] [df["week_stopped"]<9]<-1
df["dropout"] [df["week_stopped"]==9]<-0
do<-data.frame(dropout=df$dropout,age= df$age,selfmotivation= df$selfmot)
t.test(df$age~df$dropout,var.equal=TRUE)
#there is a significant difference between age and dropping out
model<- glm(formula = dropout ~ age, family = "binomial", data = do)
summary(model)
#data shows that being older decreseas the logistical odds of dropping out by 0.04
exp(coef(model))
#the odds of dropping out decreases by 0.965 as age increases
plot(model)
plot(df$age,df$dropout,xlab ="Age (Years)",ylab ="Drop out(Yes/No)",main = 'Relationship Between Age and Dropping Out')
```

## Question 5b

```{r q5b}

```

## Question 5c

```{r q5c}
model2<- glm(formula = dropout ~ selfmotivation, family = "binomial", data = do)
summary(model2)
t.test(df$selfmot~df$dropout,var.equal=TRUE)
#confidence interval does not include 0, likely to reject the null hypothesis
plot(model2)
hist(do$dropout,xlab ="Drop Out (Yes/No)",ylab ="No. of Participants",main = 'Participants Who Dropped Out of Program')
plot(df$selfmot,df$dropout,xlab ="Self-Motivation",ylab ="Drop out(Yes/No)",main = 'Relationship between self-motivation and dropping out')
#no significant relationship between probability of quitting and self-motivation in this dataset.
```










