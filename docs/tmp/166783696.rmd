---
title: "USMR 2021-2022 Coursework"
author: "`r params$examnumber`"
date: "`r Sys.Date()`"
output:
  html_document: default
  word_document: default
  pdf_document: default
params:
  examnumber: B200552
---

<!-- We have provided a template below with headings/sub-headings for each question/sub-question. This is just a template. Feel free to add or delete code-chunks if desired.  -->
<!-- Beneath here is some code which will set everything up for you.  Anything that is needed to run your code should be explicitly set up below -->

```{r setup, include=FALSE}
# this line will mean that when you compile/knit your document, 
# the code will not show, but the output (e.g., plots) will!
knitr::opts_chunk$set(echo = FALSE)
# this line means all numeric output gets rounded to 3 dp
options(digits=3)
# load any other packages that you require here:
library(tidyverse)
# This will read in your own personal data:
source("https://uoepsy.github.io/data/usmr_2122_data.R")
options(digits = 3)
```

# Question 0
<!-- If you have run the R code above this point (you can do this now by pressing Ctrl-Shift-Alt-P, or running the chunk above) then your data will be in a dataframe called `couchto5k`. -->
There are 131 participants (95 in Edinburgh and 36 in Glasgow), the mean age is 41 (ranging from 18-157), most people took part in spring, and the mean weeks of participation were six weeks. The mean score of happiness was 44.4 of a possible 100, and health 57 of a possible 100. Accountability mean score was 19.5 of a possible 35 and self-motivation 13.4 of a possible 35.
However, the data set includes a few outliers, which are impossible values. Therefore, there are two counts of scores of -99 (while the scale allows for values between 5-35) for self motivation, there two people claiming to be 130 or 157 years old and one person continued the programme 12 weeks, while the max. possible weeks are 9. There was also a typo for autumn. This data has been cleared to account for valid observations only and the outliers identified as impossible values were changed to NA (Not applicable).  
```{r}
summary(couchto5k)
```
There are four variables that need to be cleaned:
```{r, include = FALSE}
# Neither output nor code from this chunk will be shown in the compiled document. 


```

```{r}
dat<-couchto5k
# Age ---------------------------------------------------------------------
dat$age[dat$age > 100] = NA


# Self Motivation ---------------------------------------------------------

dat$selfmot[dat$selfmot == "-99"] = NA


# Season ------------------------------------------------------------------

table(dat$season)
dat$season[dat$season == "autunm"] = "autumn"


# Weeks -------------------------------------------------------------------

dat$week_stopped[dat$week_stopped>9] = NA

```

```{r}
edinburgh = filter(dat, city == "Edinburgh")
glasgow = filter(dat, city == "Glasgow")
```




```{r}
# Code will not be shown from this chunk (because we set echo = FALSE in the very first chunk)
# the output from this code will be shown. 


```
```{r}
summary(dat)
```
```{r}
dat$week_stopped[dat$week_stopped>9] = NA

edinburgh = filter(dat, city == "Edinburgh")
grasgow = filter(dat, city == "Glasgow")
```


# Question 1 

## Question 1a
43% of participants abandoned the programme before the halfway point in week 5 - which is 2% less than the national survey found earlier. A further 7% dropped just before the completion of 9 weeks - again less than found by the national survey (10%). 
```{r}


# 1a


half_mark<- dat
half_mark = filter(dat, week_stopped<5)
56/131
```
43% dropped out after 5 weeks. 

```{r}
before_end <- filter(dat, week_stopped>5)
before_end_2 <- filter (before_end, week_stopped<9)
9/131
```

## Question 1b
In Edinburgh  a little over 43% dropped out while just under 6% dropped out in Glasgow. Before the end a just over 7% dropped out in Edinburgh,while in Glasgow just under 42% did not make it to the end. Just under 53% in Glasgow finished the prorgram compared to just over 48% in Edinburgh. 
```{r q1b}
# Table
city_differences <- matrix(c(41,7,46, 2,15,19), ncol=3, byrow = TRUE)
colnames(city_differences) <- c("Halfmark", "Before End", "Completed")
rownames(city_differences) <- c("Edinburgh", "Glasgow")
city_differences
```
```{r}
41/95
7/95
46/95
2/36
15/36
19/36
```

## Question 1c
The averge age of participants varied statistically significant between cities (t(128)=37, p < .0001, two-tailed).
```{r q1c}
dat2 <- dat
dat2$city <- as.factor(dat2$city)
dat2$city <- ifelse(dat2$city == "Edinburgh", 0, 1)
```
****In order to answer the question city had to be changed to a numerical value. Edinburgh was defined as 0, thus Glasgow was autmatically assigned 1****
```{r}
age <- dat2$age
city <- dat2$city

t.test(age, city)
```


```{r}

# Question 2

```
A linear regression was calculated to predict happiness based on the season participants were interviewed. An effect was found F=(3,127), p= 0.02), with an R2 of 0.049. However this effect was only found to be statistically significant for autumn (p<0.005), spring (p<0.006) and summer (p<0.05), but not winter (p=0.037). However, the model only accounts for just under 5% (R2 of 0.049) of the variance,which suggests that another variable than season may have a significant effect. 
The assumptions of a linear model are not perfect (especially for the normaility of standarized residuals), however it was concluded that they are still met. 
```{r}
dat$season <- as.factor(dat$season)
season_happiness <- lm(happiness ~ season, data = dat)
summary(season_happiness)
plot(season_happiness)
```


## Question 2b
A linear regression was calculated to predict happiness based on age. A very weak and statistically insignificant effect size   F=(1,127), p= 0.987) was found, with an R2 of -0.008. Therefore it may not be useful to know about age when making predictions about happiness. 


```{r}
age_happiness <- lm(happiness ~ age, data = dat)
summary(age_happiness)
```

## Question 2c

Picking season's effect on happiness seems more relevant. Factor in Scotland, also stat. significant
The baseline model that I have picked is happiness predicted by season. The reasoning behind this is twofold. On one hand, while both have low effect sizes, season appeared to be statisically significant for most season. On the other hand, it appears logically that the season may affect your happiness - especially in a country like Scotland.


# Question 3

## Question 3a
because spring is significant there it still was valid to look at this - however overall there doesnt seem to be significant impact of completion and season on happiness

```{r}
new <- dat 
new$week_stopped<-as.factor(new$week_stopped)
new$week_stopped <- ifelse(new$week_stopped == 9, 1, 0)
# 1 is completed, 0 is incomplete
new$week_stopped <- as.factor(new$week_stopped)
new <- rename(new, Completed = week_stopped)
levels(new$Completed) <- c("No", "Yes")

model1 <- lm(happiness ~ Completed + season, data = new)
summary(model1)  
```
```{r}
plot(model1)
#The assumptions are not great - but close enough to conclude the model meets the linear assumption.
```

## Question 3b

```{r q3b}
model2 <- lm(happiness ~ Completed + season + health, data = new)
summary (model2)
```
```{r}
plot(model2)
#assumptions are met 
```

## Question 3c

```{r q3c}
new$time <- ifelse(dat$week_stopped < 5, 0, 1)
model3 <- lm(happiness ~ Completed + health * (time / health), data = new)
summary(model3)

```

## Question 3d
see report

# Question 4

```{r q4}
dat4 <- filter(dat, week_stopped == 9)

ggplot(dat4, aes(season, happiness, colour=city)) +
  stat_summary(fun.data = mean_se, geom = "pointrange") +
  stat_smooth() +
  theme_classic()
```
```{r descriptives}
# The type of graph was picked as it included the
#point range


```

# Question 5

## Question 5a
```{r, echo=FALSE}
new <- rename(new, SelfMotivation = selfmot)
```


```{r q5a}
Drop_Out_Predictor <- glm(Completed ~ happiness + season + health + SelfMotivation+ accountability + age + city, data=new, family = binomial)

#In order to account to answer the propability of dropping out I used 1- the prediction of completing. 
new$DO_Probability <- 1-(predict(Drop_Out_Predictor, type = "response", newdata = new))
```

## Question 5b

```{r}
ggplot(data = new, aes(x = pptID, y = DO_Probability)) +
  xlab("Participants") + ylab("Drop Out Probability") +
  geom_point() +
  stat_smooth(method = "lm", col = "dodgerblue3") +
  theme(panel.background = element_rect(fill = "white"),
        axis.line.x=element_line(),
        axis.line.y=element_line()) +
  ggtitle("Probability of quitting")
```


```

## Question 5c

```{r, echo=TRUE}
ggplot(data = new, aes(x = SelfMotivation, y = DO_Probability)) +
  xlab("Self Motivation") + ylab("Drop Out Probability") +
  geom_point() +
  stat_smooth(method = "lm", col = "dodgerblue3") +
  theme(panel.background = element_rect(fill = "white"),
        axis.line.x=element_line(),
        axis.line.y=element_line()) +
  ggtitle("Probability of quitting according to self motivation")
```










